<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Class: Audit</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/audit.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-active_audits">::active_audits</a>
    
    <li><a href="#method-c-find_incomplete_audits">::find_incomplete_audits</a>
    
    <li><a href="#method-c-fix_audits">::fix_audits</a>
    
    <li><a href="#method-c-sanity_check">::sanity_check</a>
    
    <li><a href="#method-i-audit_state">#audit_state</a>
    
    <li><a href="#method-i-auditor">#auditor</a>
    
    <li><a href="#method-i-check_count">#check_count</a>
    
    <li><a href="#method-i-clear_all_checks">#clear_all_checks</a>
    
    <li><a href="#method-i-clear_message">#clear_message</a>
    
    <li><a href="#method-i-completed_check_count">#completed_check_count</a>
    
    <li><a href="#method-i-completed_peer_audit_check_count">#completed_peer_audit_check_count</a>
    
    <li><a href="#method-i-completed_self_audit_check_count">#completed_self_audit_check_count</a>
    
    <li><a href="#method-i-completion_stats">#completion_stats</a>
    
    <li><a href="#method-i-create_checklist">#create_checklist</a>
    
    <li><a href="#method-i-dump_all">#dump_all</a>
    
    <li><a href="#method-i-filtered_checklist">#filtered_checklist</a>
    
    <li><a href="#method-i-get_design_checks">#get_design_checks</a>
    
    <li><a href="#method-i-get_section_teammate">#get_section_teammate</a>
    
    <li><a href="#method-i-is_complete-3F">#is_complete?</a>
    
    <li><a href="#method-i-is_peer_audit-3F">#is_peer_audit?</a>
    
    <li><a href="#method-i-is_peer_auditor-3F">#is_peer_auditor?</a>
    
    <li><a href="#method-i-is_self_audit-3F">#is_self_audit?</a>
    
    <li><a href="#method-i-is_self_auditor-3F">#is_self_auditor?</a>
    
    <li><a href="#method-i-manage_auditor_list">#manage_auditor_list</a>
    
    <li><a href="#method-i-message">#message</a>
    
    <li><a href="#method-i-message-3F">#message?</a>
    
    <li><a href="#method-i-next_subsection">#next_subsection</a>
    
    <li><a href="#method-i-orphaned_design_checks">#orphaned_design_checks</a>
    
    <li><a href="#method-i-peer_auditor">#peer_auditor</a>
    
    <li><a href="#method-i-peer_auditor_list">#peer_auditor_list</a>
    
    <li><a href="#method-i-peer_check_count">#peer_check_count</a>
    
    <li><a href="#method-i-peer_percent_complete">#peer_percent_complete</a>
    
    <li><a href="#method-i-peer_update-3F">#peer_update?</a>
    
    <li><a href="#method-i-previous_subsection">#previous_subsection</a>
    
    <li><a href="#method-i-process_design_checks">#process_design_checks</a>
    
    <li><a href="#method-i-process_peer_audit_update">#process_peer_audit_update</a>
    
    <li><a href="#method-i-process_self_audit_update">#process_self_audit_update</a>
    
    <li><a href="#method-i-reset">#reset</a>
    
    <li><a href="#method-i-section_auditor-3F">#section_auditor?</a>
    
    <li><a href="#method-i-self_auditor">#self_auditor</a>
    
    <li><a href="#method-i-self_auditor_list">#self_auditor_list</a>
    
    <li><a href="#method-i-self_check_count">#self_check_count</a>
    
    <li><a href="#method-i-self_percent_complete">#self_percent_complete</a>
    
    <li><a href="#method-i-self_update-3F">#self_update?</a>
    
    <li><a href="#method-i-set_message">#set_message</a>
    
    <li><a href="#method-i-trim_checklist_for_design_type">#trim_checklist_for_design_type</a>
    
    <li><a href="#method-i-trim_checklist_for_peer_audit">#trim_checklist_for_peer_audit</a>
    
    <li><a href="#method-i-trim_checklist_for_self_audit">#trim_checklist_for_self_audit</a>
    
    <li><a href="#method-i-update_checklist_type">#update_checklist_type</a>
    
    <li><a href="#method-i-update_design_check">#update_design_check</a>
    
    <li><a href="#method-i-update_peer_check_count">#update_peer_check_count</a>
    
    <li><a href="#method-i-update_self_check_count">#update_self_check_count</a>
    
    <li><a href="#method-i-update_type">#update_type</a>
    
    <li><a href="#method-i-verify_all_checks">#verify_all_checks</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Audit.html">Audit</a>
  
    <li><a href="./AuditComment.html">AuditComment</a>
  
    <li><a href="./AuditController.html">AuditController</a>
  
    <li><a href="./AuditMailer.html">AuditMailer</a>
  
    <li><a href="./AuditTeammate.html">AuditTeammate</a>
  
    <li><a href="./Board.html">Board</a>
  
    <li><a href="./BoardController.html">BoardController</a>
  
    <li><a href="./BoardDesignEntry.html">BoardDesignEntry</a>
  
    <li><a href="./BoardDesignEntryController.html">BoardDesignEntryController</a>
  
    <li><a href="./BoardDesignEntryMailer.html">BoardDesignEntryMailer</a>
  
    <li><a href="./BoardDesignEntryUser.html">BoardDesignEntryUser</a>
  
    <li><a href="./BoardHelper.html">BoardHelper</a>
  
    <li><a href="./BoardReviewer.html">BoardReviewer</a>
  
    <li><a href="./CcListHistory.html">CcListHistory</a>
  
    <li><a href="./ChangeClass.html">ChangeClass</a>
  
    <li><a href="./ChangeClassesController.html">ChangeClassesController</a>
  
    <li><a href="./ChangeDetail.html">ChangeDetail</a>
  
    <li><a href="./ChangeDetailsController.html">ChangeDetailsController</a>
  
    <li><a href="./ChangeItem.html">ChangeItem</a>
  
    <li><a href="./ChangeItemsController.html">ChangeItemsController</a>
  
    <li><a href="./ChangeType.html">ChangeType</a>
  
    <li><a href="./ChangeTypesController.html">ChangeTypesController</a>
  
    <li><a href="./Check.html">Check</a>
  
    <li><a href="./CheckController.html">CheckController</a>
  
    <li><a href="./Checklist.html">Checklist</a>
  
    <li><a href="./ChecklistController.html">ChecklistController</a>
  
    <li><a href="./ChecklistHelper.html">ChecklistHelper</a>
  
    <li><a href="./CoreExtensions.html">CoreExtensions</a>
  
    <li><a href="./DbCheck.html">DbCheck</a>
  
    <li><a href="./DebugController.html">DebugController</a>
  
    <li><a href="./DebugHelper.html">DebugHelper</a>
  
    <li><a href="./Design.html">Design</a>
  
    <li><a href="./DesignCenter.html">DesignCenter</a>
  
    <li><a href="./DesignCenterController.html">DesignCenterController</a>
  
    <li><a href="./DesignCenterManagerController.html">DesignCenterManagerController</a>
  
    <li><a href="./DesignChange.html">DesignChange</a>
  
    <li><a href="./DesignChangesController.html">DesignChangesController</a>
  
    <li><a href="./DesignChangesHelper.html">DesignChangesHelper</a>
  
    <li><a href="./DesignCheck.html">DesignCheck</a>
  
    <li><a href="./DesignController.html">DesignController</a>
  
    <li><a href="./DesignDirectory.html">DesignDirectory</a>
  
    <li><a href="./DesignDirectoryController.html">DesignDirectoryController</a>
  
    <li><a href="./DesignPcbasHelper.html">DesignPcbasHelper</a>
  
    <li><a href="./DesignReview.html">DesignReview</a>
  
    <li><a href="./DesignReviewComment.html">DesignReviewComment</a>
  
    <li><a href="./DesignReviewController.html">DesignReviewController</a>
  
    <li><a href="./DesignReviewDocument.html">DesignReviewDocument</a>
  
    <li><a href="./DesignReviewHelper.html">DesignReviewHelper</a>
  
    <li><a href="./DesignReviewMailer.html">DesignReviewMailer</a>
  
    <li><a href="./DesignReviewResult.html">DesignReviewResult</a>
  
    <li><a href="./DesignReviewResultController.html">DesignReviewResultController</a>
  
    <li><a href="./DesignUpdate.html">DesignUpdate</a>
  
    <li><a href="./DesignUpdateController.html">DesignUpdateController</a>
  
    <li><a href="./Division.html">Division</a>
  
    <li><a href="./DivisionController.html">DivisionController</a>
  
    <li><a href="./Document.html">Document</a>
  
    <li><a href="./DocumentController.html">DocumentController</a>
  
    <li><a href="./DocumentMailer.html">DocumentMailer</a>
  
    <li><a href="./DocumentType.html">DocumentType</a>
  
    <li><a href="./DocumentTypeController.html">DocumentTypeController</a>
  
    <li><a href="./EcoComment.html">EcoComment</a>
  
    <li><a href="./EcoDocument.html">EcoDocument</a>
  
    <li><a href="./EcoDocumentsController.html">EcoDocumentsController</a>
  
    <li><a href="./EcoTask.html">EcoTask</a>
  
    <li><a href="./EcoTaskMailer.html">EcoTaskMailer</a>
  
    <li><a href="./EcoTaskReportsController.html">EcoTaskReportsController</a>
  
    <li><a href="./EcoTasksController.html">EcoTasksController</a>
  
    <li><a href="./EcoType.html">EcoType</a>
  
    <li><a href="./FabHouse.html">FabHouse</a>
  
    <li><a href="./FabHouseController.html">FabHouseController</a>
  
    <li><a href="./FtpNotification.html">FtpNotification</a>
  
    <li><a href="./IncomingDirectory.html">IncomingDirectory</a>
  
    <li><a href="./IncomingDirectoryController.html">IncomingDirectoryController</a>
  
    <li><a href="./IpdPost.html">IpdPost</a>
  
    <li><a href="./IpdPostHelper.html">IpdPostHelper</a>
  
    <li><a href="./Location.html">Location</a>
  
    <li><a href="./LocationController.html">LocationController</a>
  
    <li><a href="./LoginSystem.html">LoginSystem</a>
  
    <li><a href="./MailerMethods.html">MailerMethods</a>
  
    <li><a href="./OiAssignment.html">OiAssignment</a>
  
    <li><a href="./OiAssignmentComment.html">OiAssignmentComment</a>
  
    <li><a href="./OiAssignmentReport.html">OiAssignmentReport</a>
  
    <li><a href="./OiCategory.html">OiCategory</a>
  
    <li><a href="./OiCategorySection.html">OiCategorySection</a>
  
    <li><a href="./OiInstruction.html">OiInstruction</a>
  
    <li><a href="./OiInstructionController.html">OiInstructionController</a>
  
    <li><a href="./OiInstructionHelper.html">OiInstructionHelper</a>
  
    <li><a href="./OiInstructionMailer.html">OiInstructionMailer</a>
  
    <li><a href="./PartNum.html">PartNum</a>
  
    <li><a href="./PartNumber.html">PartNumber</a>
  
    <li><a href="./PartNumsController.html">PartNumsController</a>
  
    <li><a href="./PartNumsHelper.html">PartNumsHelper</a>
  
    <li><a href="./Pcbtr.html">Pcbtr</a>
  
    <li><a href="./Ping.html">Ping</a>
  
    <li><a href="./PingMailer.html">PingMailer</a>
  
    <li><a href="./Platform.html">Platform</a>
  
    <li><a href="./PlatformController.html">PlatformController</a>
  
    <li><a href="./PostingTimestamp.html">PostingTimestamp</a>
  
    <li><a href="./Prefix.html">Prefix</a>
  
    <li><a href="./PrefixController.html">PrefixController</a>
  
    <li><a href="./Priority.html">Priority</a>
  
    <li><a href="./PriorityController.html">PriorityController</a>
  
    <li><a href="./ProductType.html">ProductType</a>
  
    <li><a href="./ProductTypeController.html">ProductTypeController</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectController.html">ProjectController</a>
  
    <li><a href="./ReportController.html">ReportController</a>
  
    <li><a href="./ReportHelper.html">ReportHelper</a>
  
    <li><a href="./ReviewGroup.html">ReviewGroup</a>
  
    <li><a href="./ReviewGroupController.html">ReviewGroupController</a>
  
    <li><a href="./ReviewManagerController.html">ReviewManagerController</a>
  
    <li><a href="./ReviewStatus.html">ReviewStatus</a>
  
    <li><a href="./ReviewStatusController.html">ReviewStatusController</a>
  
    <li><a href="./ReviewType.html">ReviewType</a>
  
    <li><a href="./ReviewTypeController.html">ReviewTypeController</a>
  
    <li><a href="./Revision.html">Revision</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./RoleController.html">RoleController</a>
  
    <li><a href="./Section.html">Section</a>
  
    <li><a href="./SectionController.html">SectionController</a>
  
    <li><a href="./SessionCleaner.html">SessionCleaner</a>
  
    <li><a href="./Subsection.html">Subsection</a>
  
    <li><a href="./SubsectionController.html">SubsectionController</a>
  
    <li><a href="./TimeHelper.html">TimeHelper</a>
  
    <li><a href="./TrackerController.html">TrackerController</a>
  
    <li><a href="./TrackerFix.html">TrackerFix</a>
  
    <li><a href="./TrackerHelper.html">TrackerHelper</a>
  
    <li><a href="./TrackerMailer.html">TrackerMailer</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserController.html">UserController</a>
  
    <li><a href="./UserLogin.html">UserLogin</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Audit</h1>

  <div id="description" class="description">
    
<p>Copyright 2005, by Teradyne, Inc., Boston MA</p>

<p>File: audit.rb</p>

<p>This file maintains the state for audits.</p>

<p>$Id$</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="AUDIT_COMPLETE">AUDIT_COMPLETE
        
        <dd class="description"><p>Constants</p>
        
      
        <dt id="PEER_AUDIT">PEER_AUDIT
        
        <dd class="description">
        
      
        <dt id="SELF_AUDIT">SELF_AUDIT
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-active_audits" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            active_audits(user) &rarr; array
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Find active audits for a designer</p>

<p>Returns a list of active audits for the designer (user) as an array</p>
          

          
          <div class="method-source-code" id="active_audits-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">active_audits</span>(<span class="ruby-identifier">user</span>)

  <span class="ruby-identifier">audits</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_incomplete_audits</span>
  
  <span class="ruby-identifier">audits</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">is_self_audit?</span>
      <span class="ruby-operator">!</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">at</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">at</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> } <span class="ruby-operator">||</span> 
        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-operator">!</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">at</span><span class="ruby-operator">|</span> <span class="ruby-identifier">at</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">at</span>.<span class="ruby-identifier">self?</span> } <span class="ruby-operator">||</span>
        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">audits</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">priority</span>.<span class="ruby-identifier">value</span> }

<span class="ruby-keyword">end</span></pre>
          </div><!-- active_audits-source -->
          
        </div>

        

        
      </div><!-- active_audits-method -->

    
      <div id="method-c-find_incomplete_audits" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            find_incomplete_audits() &rarr; array
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Find incomplete audits</p>

<p>Returns a list of incomplete audits as an array.</p>
          

          
          <div class="method-source-code" id="find_incomplete_audits-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_incomplete_audits</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;auditor_complete=0&quot;</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;id&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_incomplete_audits-source -->
          
        </div>

        

        
      </div><!-- find_incomplete_audits-method -->

    
      <div id="method-c-fix_audits" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fix_audits</span><span
            class="method-args">(update = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Fix the audits of active designs.</p>
          

          
          <div class="method-source-code" id="fix_audits-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1227</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">fix_audits</span>(<span class="ruby-identifier">update</span> = <span class="ruby-keyword">false</span>)
  
  <span class="ruby-identifier">log</span> = []
  <span class="ruby-comment"># Find all of the active audits.</span>
  <span class="ruby-constant">Design</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,
              <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;phase_id!=#{Design::COMPLETE}&quot;</span>,
              <span class="ruby-value">:include</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:design_reviews</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">design</span><span class="ruby-operator">|</span>
              
    <span class="ruby-identifier">audit</span>     = <span class="ruby-identifier">design</span>.<span class="ruby-identifier">audit</span>
    <span class="ruby-identifier">checklist</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">checklist</span>
    
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++'</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++'</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Fixing the audit for '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">design</span>.<span class="ruby-identifier">directory_name</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'  Checklist ID:       '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'            Revision: '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">revision</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'  INITIAL CHECK COUNT TOTALS FOR THE CHECKLIST'</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'  ============================================'</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  New Design:        SELF: #{checklist.new_design_self_check_count.to_s}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;                     PEER: #{checklist.new_design_peer_check_count}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  Bareboard Design:  SELF: #{checklist.bareboard_design_self_check_count}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;                     PEER: #{checklist.bareboard_design_peer_check_count}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  Audit ID: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  INITIAL AUDIT CHECK COMPLETION COUNTS&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  =====================================&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  SELF: #{audit.designer_completed_checks.to_s}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  PEER: #{audit.auditor_completed_checks.to_s}&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">update</span>
      
      <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">compute_check_counts</span>
      
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'  UPDATED CHECK COUNT TOTALS FOR THE CHECKLIST'</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'  ============================================'</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">''</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  New Design:        SELF: #{checklist.new_design_self_check_count.to_s}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;                     PEER: #{checklist.new_design_peer_check_count}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  Bareboard Design:  SELF: #{checklist.bareboard_design_self_check_count}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;                     PEER: #{checklist.bareboard_design_peer_check_count}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">''</span>
      
      <span class="ruby-comment"># Trim off checks that were incorrectly included and update the completion counts.</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  Removing inappropriate checks from the audit.&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
      
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">orphaned_design_checks</span>
      
      <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">reload</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  UPDATED AUDIT CHECK COMPLETION COUNTS&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  =====================================&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  SELF: #{audit.designer_completed_checks.to_s}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  PEER: #{audit.auditor_completed_checks.to_s}&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
    
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">entry</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">log</span> = <span class="ruby-keyword">nil</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- fix_audits-source -->
          
        </div>

        

        
      </div><!-- fix_audits-method -->

    
      <div id="method-c-sanity_check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sanity_check</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sanity_check-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1373</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sanity_check</span>
  
  <span class="ruby-identifier">audits</span> = <span class="ruby-constant">Audit</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>)
  
  <span class="ruby-identifier">log</span> = []
  <span class="ruby-identifier">audits</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">audit</span><span class="ruby-operator">|</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">design_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'New'</span>
      <span class="ruby-identifier">total_self_checks</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_self_check_count</span>
      <span class="ruby-identifier">total_peer_checks</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_peer_check_count</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">total_self_checks</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_self_check_count</span>
      <span class="ruby-identifier">total_peer_checks</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_peer_check_count</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-identifier">completed_check_counts</span> = <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">completed_check_count</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{audit.design.directory_name} (#{audit.id})\t#{audit.checklist.revision}\t&quot;</span> <span class="ruby-operator">+</span>
           <span class="ruby-node">&quot;Self: #{audit.designer_completed_checks}/#{completed_check_counts[:self]}/#{audit.designer_complete?}/&quot;</span> <span class="ruby-operator">+</span>
           <span class="ruby-node">&quot;#{total_self_checks}\t\t&quot;</span>                                                                               <span class="ruby-operator">+</span>
           <span class="ruby-node">&quot;Peer: #{audit.auditor_completed_checks}/#{completed_check_counts[:peer]}/#{audit.auditor_complete?}/&quot;</span>    <span class="ruby-operator">+</span>
           <span class="ruby-node">&quot;#{total_peer_checks}&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_complete?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_complete?</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: Self is incomplete and Peer is complete&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_completed_checks</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">completed_check_counts</span>[<span class="ruby-value">:self</span>]
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: The stored value and the computed value for the number of completed self checks do not match&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_completed_checks</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">completed_check_counts</span>[<span class="ruby-value">:peer</span>]
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: The stored value and the computed value for the number of completed peer checks do not match&quot;</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_completed_checks</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total_self_checks</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;WARNING: Recorded more self checks complete(#{audit.designer_completed_checks})&quot;</span> <span class="ruby-operator">+</span>
             <span class="ruby-node">&quot; than there are checks #{total_self_checks}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_completed_checks</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total_peer_checks</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;WARNING: Recorded more self checks complete(#{audit.auditor_completed_checks})&quot;</span> <span class="ruby-operator">+</span>
             <span class="ruby-node">&quot; than there are checks #{total_peer_checks}&quot;</span>
    <span class="ruby-keyword">end</span>

    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_completed_checks</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">total_self_checks</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_complete?</span>
        <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: Self check not marked complete, but all checks have been checked&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">designer_complete?</span>
        <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: Self check marked complete, but not all checks have been checked&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_completed_checks</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">total_peer_checks</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_complete?</span>
        <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: Peer check not marked complete, but all checks have been checked&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">audit</span>.<span class="ruby-identifier">auditor_complete?</span>
        <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;WARNING: Peer check marked complete, but not all checks have been checked&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-identifier">entry</span> }
  
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- sanity_check-source -->
          
        </div>

        

        
      </div><!-- sanity_check-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-audit_state" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            audit_state() &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Report the statu of the audit.</p>

<p>Returns one of the following values that indicate the state of the audit.</p>

<pre>Audit::SELF_AUDIT::  the audit is in the self audit state
Audit::PEER_AUDIT::  the audit is in the peer audit state
Audit::AUDIT_COMPLETE:: the audit is complete</pre>
          

          
          <div class="method-source-code" id="audit_state-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">audit_state</span>

  <span class="ruby-keyword">return</span> <span class="ruby-constant">SELF_AUDIT</span>     <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">PEER_AUDIT</span>     <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">AUDIT_COMPLETE</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- audit_state-source -->
          
        </div>

        

        
      </div><!-- audit_state-method -->

    
      <div id="method-i-auditor" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            auditor(section) &rarr; user
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Provide the user record of the self of peer <a
href="Audit.html#method-i-auditor">#auditor</a> depending on the state of
the audit (self or peer)</p>

<p>Returns the user record of the <a
href="Audit.html#method-i-auditor">#auditor</a> assigned to perform the
self or peer audit depending on the state of the audit.</p>
          

          
          <div class="method-source-code" id="auditor-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1550</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">auditor</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_audit?</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_auditor</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_audit?</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_auditor</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-keyword">end</span>
 <span class="ruby-keyword">end</span></pre>
          </div><!-- auditor-source -->
          
        </div>

        

        
      </div><!-- auditor-method -->

    
      <div id="method-i-check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-check_count">#check_count</a></p>

<p>Description: This method returns the number of checks for the designer and
the peer based on the design type.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 352</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_count</span>

  <span class="ruby-identifier">count</span>     = { <span class="ruby-value">:designer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-value">:peer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }
  <span class="ruby-identifier">checklist</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>

  <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">design_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'New'</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:designer</span>] = <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_self_check_count</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:peer</span>]     = <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_peer_check_count</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'Dot Rev'</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:designer</span>] = <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_self_check_count</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:peer</span>]     = <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_peer_check_count</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">count</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_count-source -->
          
        </div>

        

        
      </div><!-- check_count-method -->

    
      <div id="method-i-clear_all_checks" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            clear_all_checks() &rarr; boolean
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Reset all of the audit’s design checks.</p>

<p>Set all design check results, both self and peer, to ‘None’ and <a
href="Audit.html#method-i-reset">#reset</a> the audit’s state variables.</p>
          

          
          <div class="method-source-code" id="clear_all_checks-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_all_checks</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_checklist_for_design_type</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_design_checks</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>  = <span class="ruby-string">'None'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_peer_check?</span>
    <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span> = <span class="ruby-string">'None'</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_self_check?</span>
    <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span>  = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete</span>          = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete</span>         = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- clear_all_checks-source -->
          
        </div>

        

        
      </div><!-- clear_all_checks-method -->

    
      <div id="method-i-clear_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-clear_message">#clear_message</a></p>

<p>Description: The method clears all of the  error messages</p>

<p>Parameters: None</p>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="clear_message-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1062</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_message</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clear_message-source -->
          
        </div>

        

        
      </div><!-- clear_message-method -->

    
      <div id="method-i-completed_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">completed_check_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-completed_check_count">#completed_check_count</a></p>

<p>Description: Returns the number of design checks that are completed for
both the self and peer audit.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="completed_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">completed_check_count</span>
  
  <span class="ruby-identifier">count</span> = { <span class="ruby-value">:self</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-value">:peer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">design_check</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">id</span> }
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">design_check</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:self</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">self_auditor_checked?</span>
    <span class="ruby-identifier">count</span>[<span class="ruby-value">:peer</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">peer_auditor_checked?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">count</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- completed_check_count-source -->
          
        </div>

        

        
      </div><!-- completed_check_count-method -->

    
      <div id="method-i-completed_peer_audit_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">completed_peer_audit_check_count</span><span
            class="method-args">(subsection)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-completed_peer_audit_check_count">#completed_peer_audit_check_count</a></p>

<p>Description: This method provides the number of peer audit design checks
that have been completed for the subsection.</p>

<p>Parameters: subsection - the subsection record that is used to group the
design</p>

<pre>checks.</pre>
          

          
          <div class="method-source-code" id="completed_peer_audit_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 568</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">completed_peer_audit_check_count</span>(<span class="ruby-identifier">subsection</span>)

  <span class="ruby-identifier">design_checks</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">design_checks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">dc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">peer_auditor_checked?</span> }
  <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">check</span> = <span class="ruby-constant">Check</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span>)
    <span class="ruby-operator">!</span><span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">checks</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">check</span>) 
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">size</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- completed_peer_audit_check_count-source -->
          
        </div>

        

        
      </div><!-- completed_peer_audit_check_count-method -->

    
      <div id="method-i-completed_self_audit_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">completed_self_audit_check_count</span><span
            class="method-args">(subsection)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-completed_self_audit_check_count">#completed_self_audit_check_count</a></p>

<p>Description: This method provides the number of self audit design checks
that have been completed for the subsection.</p>

<p>Parameters: subsection - the subsection record that is used to group the
design</p>

<pre>checks.</pre>
          

          
          <div class="method-source-code" id="completed_self_audit_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">completed_self_audit_check_count</span>(<span class="ruby-identifier">subsection</span>)

  <span class="ruby-identifier">design_checks</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">design_checks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">dc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">self_auditor_checked?</span> }
  <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">check</span> = <span class="ruby-constant">Check</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span>)
    <span class="ruby-operator">!</span><span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">checks</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">check</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">size</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- completed_self_audit_check_count-source -->
          
        </div>

        

        
      </div><!-- completed_self_audit_check_count-method -->

    
      <div id="method-i-completion_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">completion_stats</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-completion_stats">#completion_stats</a></p>

<p>Description: This method returns percent complete statistics for the  self
and peer audit.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="completion_stats-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">completion_stats</span>

  <span class="ruby-identifier">stats</span> = { <span class="ruby-value">:self</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;0.0&quot;</span>, <span class="ruby-value">:peer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;0.0&quot;</span> }
  <span class="ruby-identifier">total_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">check_count</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_checks</span>[<span class="ruby-value">:designer</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">stats</span>[<span class="ruby-value">:self</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> * <span class="ruby-value">100.0</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">total_checks</span>[<span class="ruby-value">:designer</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_checks</span>[<span class="ruby-value">:peer</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">stats</span>[<span class="ruby-value">:peer</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span>  * <span class="ruby-value">100.0</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">total_checks</span>[<span class="ruby-value">:peer</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stats</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- completion_stats-source -->
          
        </div>

        

        
      </div><!-- completion_stats-method -->

    
      <div id="method-i-create_checklist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_checklist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-create_checklist">#create_checklist</a></p>

<p>Description: This method creates a new checklist at the kick off of a  Peer
<a href="Audit.html">Audit</a> Revew.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="create_checklist-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_checklist</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">add</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">check</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">belongs_to?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_checklist-source -->
          
        </div>

        

        
      </div><!-- create_checklist-method -->

    
      <div id="method-i-dump_all" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            dump_all() &rarr; []
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Dump the audit and all of the associated design checks</p>

<pre>Produces a dump of the audit.</pre>
          

          
          <div class="method-source-code" id="dump_all-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1719</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dump_all</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;----------------------------------------------------------------------&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  AUDIT ID: #{self.id}\t\t\tDESIGN:   #{self.design.directory_name}&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  DESIGN CHECKS: #{self.design_checks.size.to_s}&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  SELF COMPLETE: #{self.designer_complete?.to_s} &quot;</span> <span class="ruby-operator">+</span>
       <span class="ruby-node">&quot;  #{self.designer_completed_checks.to_s} (#{self.self_percent_complete.to_s}%)\t\t&quot;</span> <span class="ruby-operator">+</span>
       <span class="ruby-node">&quot;  PEER COMPLETE: #{self.auditor_complete?.to_s}  &quot;</span> <span class="ruby-operator">+</span>
       <span class="ruby-node">&quot;  #{self.auditor_completed_checks.to_s} (#{self.peer_percent_complete.to_s}%)&quot;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;----------------------------------------------------------------------&quot;</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">design_check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">printf</span>(<span class="ruby-string">&quot;  DESIGN CHECK ID: %5d\n&quot;</span>, <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-identifier">printf</span>(<span class="ruby-string">&quot;     Self Auditor: %25s  Result: %10s     At: %25s\n&quot;</span>,
           <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_id</span>).<span class="ruby-identifier">name</span>,
           <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span>,
           <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_checked_on</span>.<span class="ruby-identifier">format_dd_mm_yy_at_timestamp</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">printf</span>(<span class="ruby-string">&quot;     Peer Auditor: %25s  Result: %10s     At: %25s\n&quot;</span>,
           <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_id</span>).<span class="ruby-identifier">name</span>,
           <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>,
           <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_checked_on</span>.<span class="ruby-identifier">format_dd_mm_yy_at_timestamp</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;----------------------------------------------------------------------&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dump_all-source -->
          
        </div>

        

        
      </div><!-- dump_all-method -->

    
      <div id="method-i-filtered_checklist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filtered_checklist</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-filtered_checklist">#filtered_checklist</a></p>

<p>Description: The method will removed sections and subsections based on
whether the audit is a full, date code, or dot rev audit</p>

<p>Parameters: user - a user record that identifies the person who is logged
in.</p>

<p>Return value: The audit’s checklist will be modified as described above.</p>
          

          
          <div class="method-source-code" id="filtered_checklist-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 657</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filtered_checklist</span>(<span class="ruby-identifier">user</span>)

  <span class="ruby-identifier">sections</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">date_code?</span>
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sec</span>.<span class="ruby-identifier">date_code_check?</span> }
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsec</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subsec</span>.<span class="ruby-identifier">date_code_check?</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">dot_rev?</span>
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sec</span>.<span class="ruby-identifier">dot_rev_check?</span> }
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsec</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subsec</span>.<span class="ruby-identifier">dot_rev_check?</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_audit?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_auditor?</span>(<span class="ruby-identifier">user</span>)
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">designer_auditor_check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
    <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">subsec</span>.<span class="ruby-identifier">designer_auditor_check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- filtered_checklist-source -->
          
        </div>

        

        
      </div><!-- filtered_checklist-method -->

    
      <div id="method-i-get_design_checks" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            get_design_checks() &rarr; audit
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve and load the associated design checks</p>

<p>Go through all of the checks in the check list and attach the associated
design checks.</p>
          

          
          <div class="method-source-code" id="get_design_checks-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1530</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_design_checks</span>

  <span class="ruby-identifier">design_checks</span> = <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;audit_id=#{self.id}&quot;</span>)
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">design_check</span>       = <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">id</span> }
    <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span> = <span class="ruby-identifier">design_check</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_design_checks-source -->
          
        </div>

        

        
      </div><!-- get_design_checks-method -->

    
      <div id="method-i-get_section_teammate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_section_teammate</span><span
            class="method-args">(section)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-get_section_teammate">#get_section_teammate</a></p>

<p>Description: Retrieves the teammate for the audit section.</p>

<p>Parameters: section - a record that identifies the section</p>

<p>Return value: A user record for the teammate, if one exists.  Otherwise a
nil  is returned.</p>
          

          
          <div class="method-source-code" id="get_section_teammate-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 598</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_section_teammate</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-identifier">teammate</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">at</span><span class="ruby-operator">|</span> 
    <span class="ruby-identifier">at</span>.<span class="ruby-identifier">section_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">at</span>.<span class="ruby-identifier">self</span> <span class="ruby-operator">==</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_audit?</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If a teammate was located, return the user record.</span>
  <span class="ruby-identifier">teammate</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">teammate</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_section_teammate-source -->
          
        </div>

        

        
      </div><!-- get_section_teammate-method -->

    
      <div id="method-i-is_complete-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_complete?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-is_complete-3F">#is_complete?</a></p>

<p>Description: This method determines if the audit is complete.</p>

<p>Parameters: None</p>

<p>Return value: TRUE if the audit is in the <a
href="Audit.html#AUDIT_COMPLETE">AUDIT_COMPLETE</a> state, FALSE otherwise.</p>
          

          
          <div class="method-source-code" id="is_complete-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_complete?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_state</span> <span class="ruby-operator">==</span> <span class="ruby-constant">AUDIT_COMPLETE</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_complete-3F-source -->
          
        </div>

        

        
      </div><!-- is_complete-3F-method -->

    
      <div id="method-i-is_peer_audit-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_peer_audit?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-is_peer_audit-3F">#is_peer_audit?</a></p>

<p>Description: This method determines if the audit is a peer audit.</p>

<p>Parameters: None</p>

<p>Return value: TRUE if the audit is in the <a
href="Audit.html#PEER_AUDIT">PEER_AUDIT</a> state, FALSE otherwise.</p>
          

          
          <div class="method-source-code" id="is_peer_audit-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_peer_audit?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_state</span> <span class="ruby-operator">==</span> <span class="ruby-constant">PEER_AUDIT</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_peer_audit-3F-source -->
          
        </div>

        

        
      </div><!-- is_peer_audit-3F-method -->

    
      <div id="method-i-is_peer_auditor-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_peer_auditor?</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-is_peer_auditor-3F">#is_peer_auditor?</a></p>

<p>Description: This method determines if the user is a peer <a
href="Audit.html#method-i-auditor">#auditor</a>.</p>

<p>Parameters: user - A <a href="User.html">User</a> record for the person
this method is checking to</p>

<pre>if the person is on the peer audit team.</pre>

<p>Return value: TRUE if the user is on the peer audit team, FALSE otherwise.</p>
          

          
          <div class="method-source-code" id="is_peer_auditor-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_peer_auditor?</span>(<span class="ruby-identifier">user</span>)
  (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">||</span>
   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">t</span>.<span class="ruby-identifier">self?</span> })
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_peer_auditor-3F-source -->
          
        </div>

        

        
      </div><!-- is_peer_auditor-3F-method -->

    
      <div id="method-i-is_self_audit-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_self_audit?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-is_self_audit-3F">#is_self_audit?</a></p>

<p>Description: This method determines if the audit is a self audit.</p>

<p>Parameters: None</p>

<p>Return value: TRUE if the audit is in the <a
href="Audit.html#SELF_AUDIT">SELF_AUDIT</a> state, FALSE otherwise.</p>
          

          
          <div class="method-source-code" id="is_self_audit-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 176</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_self_audit?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_state</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SELF_AUDIT</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_self_audit-3F-source -->
          
        </div>

        

        
      </div><!-- is_self_audit-3F-method -->

    
      <div id="method-i-is_self_auditor-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_self_auditor?</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-is_self_auditor-3F">#is_self_auditor?</a></p>

<p>Description: This method determines if the user is a self <a
href="Audit.html#method-i-auditor">#auditor</a>.</p>

<p>Parameters: user - A <a href="User.html">User</a> record for the person
this method is checking to</p>

<pre>if the person is on the self audit team.</pre>

<p>Return value: TRUE if the user is on the self audit team, FALSE otherwise.</p>
          

          
          <div class="method-source-code" id="is_self_auditor-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_self_auditor?</span>(<span class="ruby-identifier">user</span>)
  (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">||</span>
   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">self?</span> })
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_self_auditor-3F-source -->
          
        </div>

        

        
      </div><!-- is_self_auditor-3F-method -->

    
      <div id="method-i-manage_auditor_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">manage_auditor_list</span><span
            class="method-args">(self_auditor_list, peer_auditor_list, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-manage_auditor_list">#manage_auditor_list</a></p>

<p>Description: The method processes updates to the audit team.  <a
href="Audit.html">Audit</a> Teammate  records are added and removed from
the database based on the user’s input.</p>

<p>Parameters: <a
href="Audit.html#method-i-self_auditor_list">#self_auditor_list</a> - a
hash of self audit assignments.  The hash</p>

<pre>is accessed by section ids (key) to provide
the user of id of the self auditor</pre>

<p><a href="Audit.html#method-i-peer_auditor_list">#peer_auditor_list</a> - a
hash of peer audit assignments.  The hash</p>

<pre>is accessed by section ids (key) to provide
the user of id of the peer auditor</pre>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="manage_auditor_list-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 859</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">manage_auditor_list</span>(<span class="ruby-identifier">self_auditor_list</span>, <span class="ruby-identifier">peer_auditor_list</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-identifier">lead_designer_assignments</span> = {}
  <span class="ruby-identifier">self_auditor_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">auditor</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lead_designer_assignments</span>[<span class="ruby-identifier">key</span>] = (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">auditor</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">lead_peer_assignments</span> = {}
  <span class="ruby-identifier">peer_auditor_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">auditor</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lead_peer_assignments</span>[<span class="ruby-identifier">key</span>] = (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">auditor</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">self_auditor_list</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer_id</span> }
  <span class="ruby-identifier">peer_auditor_list</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span> }

  <span class="ruby-identifier">audit_teammates</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>
  
  <span class="ruby-comment"># Remove any teammates if the section has been reassign back to the lead</span>
  <span class="ruby-identifier">teammate_list_updates</span> = { <span class="ruby-string">'self'</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-string">'peer'</span> =<span class="ruby-operator">&gt;</span> [] }
  <span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">audit_teammate</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">self?</span> <span class="ruby-operator">&amp;&amp;</span>
         <span class="ruby-identifier">lead_designer_assignments</span>[<span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">section_id</span>]) <span class="ruby-operator">||</span>
        (<span class="ruby-operator">!</span><span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">self?</span> <span class="ruby-operator">&amp;&amp;</span>
         <span class="ruby-identifier">lead_peer_assignments</span>[<span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">section_id</span>]))

      <span class="ruby-identifier">key</span> = <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">self?</span> <span class="ruby-operator">?</span> <span class="ruby-string">'self'</span> <span class="ruby-operator">:</span> <span class="ruby-string">'peer'</span>

      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-identifier">key</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Removed '</span>,
                                      <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">audit_teammate</span> }
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Go through the assignments and make sure the same person has</span>
  <span class="ruby-comment"># not been assigned to the same section for peer and self audits.</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clear_message</span>
  <span class="ruby-identifier">self_auditor_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">self_auditor</span><span class="ruby-operator">|</span>

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">self_auditor</span> <span class="ruby-operator">==</span> <span class="ruby-string">''</span>

    <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">self_auditor</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">peer_auditor_list</span>[<span class="ruby-identifier">section_id</span>]) <span class="ruby-operator">||</span>
        (<span class="ruby-operator">!</span><span class="ruby-identifier">peer_auditor_list</span>[<span class="ruby-identifier">section_id</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">self_auditor</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span>))
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_message</span>(<span class="ruby-string">'WARNING: Assignments not made &lt;br /&gt;'</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">message</span>
      <span class="ruby-identifier">section</span> = <span class="ruby-constant">Section</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">section_id</span>)
      <span class="ruby-identifier">auditor</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">self_auditor</span>)
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_message</span>(<span class="ruby-string">'         '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">auditor</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-string">' can not be both '</span> <span class="ruby-operator">+</span>
                       <span class="ruby-string">'self and peer auditor for '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-string">'&lt;br /&gt;'</span>,
                       <span class="ruby-string">'append'</span>)
      <span class="ruby-identifier">self_auditor_list</span>[<span class="ruby-identifier">section_id</span>] = <span class="ruby-string">''</span>
      <span class="ruby-identifier">peer_auditor_list</span>[<span class="ruby-identifier">section_id</span>] = <span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">self_auditor_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">self_auditor</span><span class="ruby-operator">|</span>

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">self_auditor</span> <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">audit_teammate</span> = <span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">self?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">section_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section_id</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">end</span>

   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">audit_teammate</span>
      <span class="ruby-identifier">audit_teammate</span> = 
        <span class="ruby-constant">AuditTeammate</span>.<span class="ruby-identifier">new_teammate</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">self_auditor</span>, <span class="ruby-value">:self</span>)
      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'self'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Added '</span>,<span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">audit_teammate</span> }
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">self_auditor</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">old_teammate</span> = 
        <span class="ruby-constant">AuditTeammate</span>.<span class="ruby-identifier">new_teammate</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:self</span>, <span class="ruby-keyword">false</span>)
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">self_auditor</span>
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">reload</span>

      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'self'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Removed '</span>, <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">old_teammate</span> }
      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'self'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Added '</span>,   <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">audit_teammate</span> }
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">peer_auditor_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">peer_auditor</span><span class="ruby-operator">|</span>
  
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">peer_auditor</span> <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
    <span class="ruby-identifier">audit_teammate</span> = <span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-operator">!</span><span class="ruby-identifier">t</span>.<span class="ruby-identifier">self?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">section_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section_id</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">end</span> 

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">audit_teammate</span>
      <span class="ruby-identifier">audit_teammate</span> = 
        <span class="ruby-constant">AuditTeammate</span>.<span class="ruby-identifier">new_teammate</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">peer_auditor</span>, <span class="ruby-value">:peer</span>)
      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'peer'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Added '</span>,
                                         <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">audit_teammate</span> }
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">peer_auditor</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">old_teammate</span> =
        <span class="ruby-constant">AuditTeammate</span>.<span class="ruby-identifier">new_teammate</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">section_id</span>, <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:peer</span>, <span class="ruby-keyword">false</span>)
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">peer_auditor</span>
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">audit_teammate</span>.<span class="ruby-identifier">reload</span>
      
      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'peer'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Removed '</span>, <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">old_teammate</span> }
      <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'peer'</span>] <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Added '</span>,   <span class="ruby-value">:teammate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">audit_teammate</span> }    
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'self'</span>].<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">teammate_list_updates</span>[<span class="ruby-string">'peer'</span>].<span class="ruby-identifier">size</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_message</span>(<span class="ruby-string">'Updates to the audit team for the '</span> <span class="ruby-operator">+</span>
                     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">directory_name</span> <span class="ruby-operator">+</span>
                     <span class="ruby-string">' have been recorded - mail was sent'</span>,
                     <span class="ruby-string">'append'</span>)
  
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reload</span>
    <span class="ruby-constant">AuditMailer</span><span class="ruby-operator">::</span><span class="ruby-identifier">audit_team_updates</span>(<span class="ruby-identifier">user</span>,
                                      <span class="ruby-keyword">self</span>,
                                      <span class="ruby-identifier">teammate_list_updates</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>

 <span class="ruby-keyword">end</span></pre>
          </div><!-- manage_auditor_list-source -->
          
        </div>

        

        
      </div><!-- manage_auditor_list-method -->

    
      <div id="method-i-message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-set_message">#set_message</a></p>

<p>Description: Returns the error <a
href="Audit.html#method-i-message">#message</a> that is stored with the
object</p>

<p>Parameters: None</p>

<p>Return value: A string representing the store error <a
href="Audit.html#method-i-message">#message</a>.</p>
          

          
          <div class="method-source-code" id="message-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">message</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">errors</span>[<span class="ruby-value">:message</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>
    <span class="ruby-identifier">message</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">message</span>.<span class="ruby-identifier">join</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- message-source -->
          
        </div>

        

        
      </div><!-- message-method -->

    
      <div id="method-i-message-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">message?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-message-3F">#message?</a></p>

<p>Description: The method indicates if there is an error <a
href="Audit.html#method-i-message">#message</a> available for the object</p>

<p>Parameters: None</p>

<p>Return value: True if an error <a
href="Audit.html#method-i-message">#message</a> exists.  Otherwise False</p>
          

          
          <div class="method-source-code" id="message-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1083</span>
 <span class="ruby-keyword">def</span> <span class="ruby-identifier">message?</span>
   <span class="ruby-comment">#errors.on(:message) != nil</span>
   <span class="ruby-identifier">errors</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- message-3F-source -->
          
        </div>

        

        
      </div><!-- message-3F-method -->

    
      <div id="method-i-next_subsection" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            next_subsection(subsection) &rarr; subsection
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve the next subsection in the audit.</p>

<pre>Returns the next subsection in the current section.  If the current subsection
is the last subsection in the section then the first subsection in the
next section is returned.  If there is no section following the current
section then a nil is returned.</pre>
          

          
          <div class="method-source-code" id="next_subsection-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1614</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_subsection</span>(<span class="ruby-identifier">subsection</span>)

  <span class="ruby-identifier">section</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">section_id</span>}
  <span class="ruby-identifier">i</span> = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">subsection</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">j</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">section</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">j</span> <span class="ruby-operator">&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>[<span class="ruby-identifier">j</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>].<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- next_subsection-source -->
          
        </div>

        

        
      </div><!-- next_subsection-method -->

    
      <div id="method-i-orphaned_design_checks" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            orphaned_design_checks
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Locate and remove any orphaned design checks associated with the audit</p>

<p>Find all design checks that were incorrectly created and processed and 
remove them from the database.  The design checks were created due to a 
bug that existed that blindly created design checks new designs.  The
program should not have create design checks for checks that only apply to
bareboard designs. In addition, those design checks were filled out by the
self and peer auditors. The completion stats reflect that.  The numbers
recorded in the audit are  adjusted when the design checks are destroyed.</p>
          

          
          <div class="method-source-code" id="orphaned_design_checks-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1315</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">orphaned_design_checks</span>
  
  <span class="ruby-identifier">log</span> = []
  
  <span class="ruby-identifier">total_design_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_checklist_for_design_type</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_design_checks</span>
  
  <span class="ruby-identifier">completed_check_counts</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">completed_check_count</span>
  
  <span class="ruby-identifier">attached_design_checks</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ch</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attached_design_checks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">design_check</span> }

  <span class="ruby-identifier">directory_name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">directory_name</span>
  
  <span class="ruby-identifier">orphaned_design_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">attached_design_checks</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">orphaned_design_checks</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> = <span class="ruby-identifier">completed_check_counts</span>[<span class="ruby-value">:self</span>]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span>  = <span class="ruby-identifier">completed_check_counts</span>[<span class="ruby-value">:peer</span>]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
    
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    REMOVING INAPPROPRIATE DESIGN CHECKS&quot;</span>
    <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&quot;</span>

    <span class="ruby-identifier">orphaned_design_checks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">check</span> = <span class="ruby-constant">Check</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span>)
      
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    DESIGN CHECK    ID:           &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;                    CHECK ID:     &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;                    SELF CHECKED: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">self_auditor_checked?</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;                    PEER CHECKED: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">peer_auditor_checked?</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;                    NEW REVIEW:   &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">full_review?</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;                    BB REVIEW:    &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">dot_rev_check?</span>.<span class="ruby-identifier">to_s</span>
      
      <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">destroy</span>        
      
      <span class="ruby-identifier">design_check_list</span> = <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;audit_id=#{self.id} AND check_id=#{dc.check_id}&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check_list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    **********************************************&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    **********************************************&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    ***** WARNING: FOUND MULTIPLE DESIGN CHECKS!!!&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    **********************************************&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    **********************************************&quot;</span>
          <span class="ruby-identifier">log</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">log</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- orphaned_design_checks-source -->
          
        </div>

        

        
      </div><!-- orphaned_design_checks-method -->

    
      <div id="method-i-peer_auditor" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            peer_audtor(section) &rarr; user
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve the peer <a href="Audit.html#method-i-auditor">#auditor</a> for
the section.</p>

<pre>If a peer auditor for the section is assigned then the user record is returned.
Otherwise the user record for the design's lead peer auditor is returned.
A nil is returned if none of the above conditions apply.</pre>
          

          
          <div class="method-source-code" id="peer_auditor-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1590</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_auditor</span>(<span class="ruby-identifier">section</span>)
  
  <span class="ruby-identifier">auditor</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">tmate</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tmate</span>.<span class="ruby-identifier">section_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tmate</span>.<span class="ruby-identifier">self?</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">auditor</span> 
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">auditor</span>.<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- peer_auditor-source -->
          
        </div>

        

        
      </div><!-- peer_auditor-method -->

    
      <div id="method-i-peer_auditor_list" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            peer_audtor_list() &rarr; array
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve a list of designers eligible to perform a peer audit.</p>

<p>The array returned contains a list of active designers with the record for
the lead designer removed.</p>
          

          
          <div class="method-source-code" id="peer_auditor_list-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_auditor_list</span>
  <span class="ruby-ivar">@peer_auditor_list</span> <span class="ruby-operator">||=</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_auditor_list</span> <span class="ruby-operator">-</span> [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- peer_auditor_list-source -->
          
        </div>

        

        
      </div><!-- peer_auditor_list-method -->

    
      <div id="method-i-peer_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">peer_check_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-peer_check_count">#peer_check_count</a></p>

<p>Description: This method returns the number of checks for the peer audit
team based on the design type.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="peer_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_check_count</span>

  <span class="ruby-identifier">checklist</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>

  <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">design_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'New'</span>
    <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_peer_check_count</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'Dot Rev'</span>
    <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_peer_check_count</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- peer_check_count-source -->
          
        </div>

        

        
      </div><!-- peer_check_count-method -->

    
      <div id="method-i-peer_percent_complete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">peer_percent_complete</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-peer_percent_complete">#peer_percent_complete</a></p>

<p>Description: This method returns percent complete statistics for the  peer
audit team.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="peer_percent_complete-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 411</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_percent_complete</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_check_count</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span> * <span class="ruby-value">100.0</span> <span class="ruby-operator">/</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_check_count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-value">100.0</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- peer_percent_complete-source -->
          
        </div>

        

        
      </div><!-- peer_percent_complete-method -->

    
      <div id="method-i-peer_update-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">peer_update?</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-peer_update-3F">#peer_update?</a></p>

<p>Description: The method determines if the update that is being processed is
a peer audit update.</p>

<p>Parameters: user - a user record that identifies the person who is logged
in.</p>

<p>Return value: True if the update is to the peer audit.  Otherwise, false</p>
          

          
          <div class="method-source-code" id="peer_update-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 747</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peer_update?</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_audit?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_auditor?</span>(<span class="ruby-identifier">user</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- peer_update-3F-source -->
          
        </div>

        

        
      </div><!-- peer_update-3F-method -->

    
      <div id="method-i-previous_subsection" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            previous_subsection(subsection) &rarr; subsection
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve the previous subsection in the audit.</p>

<pre>Returns the previous subsection in the current section.  If the current subsection
is the first subsection in the section then the last subsection in the
previous section is returned.  If there is no section preceeding the current
section then a nil is returned.</pre>
          

          
          <div class="method-source-code" id="previous_subsection-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1640</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">previous_subsection</span>(<span class="ruby-identifier">subsection</span>)

  <span class="ruby-identifier">section</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">section_id</span>}
  <span class="ruby-identifier">i</span> = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">subsection</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">j</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">section</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">j</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>[<span class="ruby-identifier">j</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>].<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- previous_subsection-source -->
          
        </div>

        

        
      </div><!-- previous_subsection-method -->

    
      <div id="method-i-process_design_checks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_design_checks</span><span
            class="method-args">(design_check_list, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-process_design_checks">#process_design_checks</a></p>

<p>Description: Processes a list of design check updates.  Processing is done
for  both the self and peer updates.</p>

<p>Parameters: design_check_list - a list of self or peer design check updates
user              - the record for the user making the update</p>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="process_design_checks-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 995</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_design_checks</span>(<span class="ruby-identifier">design_check_list</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-comment"># Go through the paramater list and pull out the checks.</span>
  <span class="ruby-identifier">design_check_list</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">design_check_update</span><span class="ruby-operator">|</span>

    <span class="ruby-identifier">design_check</span> = <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:design_check_id</span>])

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_update?</span>(<span class="ruby-identifier">user</span>)
      <span class="ruby-identifier">result</span>        = <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span>
      <span class="ruby-identifier">result_update</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:designer_result</span>]
    <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_update?</span>(<span class="ruby-identifier">user</span>)
      <span class="ruby-identifier">result</span>        = <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>
      <span class="ruby-identifier">result_update</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:auditor_result</span>]
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:comment</span>].<span class="ruby-identifier">strip</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result_update</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result_update</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">result</span>

      <span class="ruby-comment"># Make sure that the required comment has been added.</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span>
         <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">comment_required?</span>(<span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:designer_result</span>], 
                                        <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:auditor_result</span>])
       
        <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">id</span>] = <span class="ruby-string">'A comment is required for a '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">result_update</span> <span class="ruby-operator">+</span>
                                 <span class="ruby-string">' response.'</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-string">'notice'</span>]        = <span class="ruby-string">'Not all checks were updated - please review '</span> <span class="ruby-operator">+</span>
                                 <span class="ruby-string">'the form for errors.'</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_update?</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_self_audit_update</span>(<span class="ruby-identifier">result_update</span>, <span class="ruby-identifier">design_check</span>, <span class="ruby-identifier">user</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_update?</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_peer_audit_update</span>(<span class="ruby-identifier">result_update</span>, 
                                       <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:comment</span>], 
                                       <span class="ruby-identifier">design_check</span>, 
                                       <span class="ruby-identifier">user</span>)
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If the user entered a comment, update the database.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      <span class="ruby-constant">AuditComment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>,
                       <span class="ruby-value">:design_check_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">create</span>
    <span class="ruby-keyword">end</span>
  }

<span class="ruby-keyword">end</span></pre>
          </div><!-- process_design_checks-source -->
          
        </div>

        

        
      </div><!-- process_design_checks-method -->

    
      <div id="method-i-process_peer_audit_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_peer_audit_update</span><span
            class="method-args">(result_update, comment, design_check, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-process_peer_audit_update">#process_peer_audit_update</a></p>

<p>Description: The method processes peer audit input.  If the result is
anything than “None” or “Comment then the <a
href="Audit.html#method-i-auditor">#auditor</a> completed checks is 
incremented and the design_check.auditor_result is updated with the  new
result.  If the peer audit is complete then email is sent indicating  that
the peer audit is complete.</p>

<p>Parameters: result_update - the result for the design check entered by the
user comment       - the optional comment entered by the reviewer
design_check  - the design check that is being updated user          - a
user record that identifies the person who is</p>

<pre>logged in.</pre>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="process_peer_audit_update-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_peer_audit_update</span>(<span class="ruby-identifier">result_update</span>, <span class="ruby-identifier">comment</span>, <span class="ruby-identifier">design_check</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-identifier">check</span> = <span class="ruby-constant">Check</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">check_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">check_type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'designer_auditor'</span>

  <span class="ruby-identifier">incr</span> = <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">update_auditor_result</span>(<span class="ruby-identifier">result_update</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">incr</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_peer_check_count</span>(<span class="ruby-identifier">incr</span>)
    <span class="ruby-constant">AuditMailer</span>.<span class="ruby-identifier">peer_audit_complete</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">AuditMailer</span><span class="ruby-operator">::</span><span class="ruby-identifier">audit_update</span>(<span class="ruby-identifier">design_check</span>,
                                      <span class="ruby-identifier">comment</span>,
                                      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer</span>,
                                      <span class="ruby-identifier">user</span>).<span class="ruby-identifier">deliver</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">result_update</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Comment'</span>
 <span class="ruby-keyword">end</span></pre>
          </div><!-- process_peer_audit_update-source -->
          
        </div>

        

        
      </div><!-- process_peer_audit_update-method -->

    
      <div id="method-i-process_self_audit_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_self_audit_update</span><span
            class="method-args">(result_update, design_check, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-process_self_audit_update">#process_self_audit_update</a></p>

<p>Description: The method processes self audit input.  If the result is
anything than “None” then the designer completed checks is incremented and 
the design_check.designer_result is updated with the new result. If the
self audit is complete then email is sent indicating that the self audit is
complete and another is sent to indicate that the final review will be
posted shortly.</p>

<p>Parameters: result_update - the result for the design check entered by the
user design_check  - the design check that is being updated user          -
a user record that identifies the person who is</p>

<pre>logged in.</pre>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="process_self_audit_update-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 775</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_self_audit_update</span>(<span class="ruby-identifier">result_update</span>, <span class="ruby-identifier">design_check</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;None&quot;</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_self_check_count</span>
 
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete?</span>
      <span class="ruby-constant">AuditMailer</span>.<span class="ruby-identifier">self_audit_complete</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span>
      <span class="ruby-constant">AuditMailer</span>.<span class="ruby-identifier">final_review_warning</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>).<span class="ruby-identifier">deliver</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reload</span>
    
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">update_designer_result</span>(<span class="ruby-identifier">result_update</span>, <span class="ruby-identifier">user</span>)
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_self_audit_update-source -->
          
        </div>

        

        
      </div><!-- process_self_audit_update-method -->

    
      <div id="method-i-reset" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            reset() &rarr; []
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Reset the audit and all of the associated design checks</p>

<pre>Updates the audit record to reset as well as all of the associated
design check records.</pre>
          

          
          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1752</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">skip</span>                      = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete</span>         = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete</span>          = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span>  = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">design_check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>      = <span class="ruby-string">'None'</span>
    <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span>     = <span class="ruby-string">'None'</span>
    <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_checked_on</span>  = <span class="ruby-identifier">now</span>
    <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_checked_on</span> = <span class="ruby-identifier">now</span>
    <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">nil</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset-source -->
          
        </div>

        

        
      </div><!-- reset-method -->

    
      <div id="method-i-section_auditor-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">section_auditor?</span><span
            class="method-args">(section, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-section_auditor-3F">#section_auditor?</a></p>

<p>Description: Indicates that the user can perform the audit for the audit
section.</p>

<p>Parameters: section - a record that identifies the section user    - a
record that identifies the user</p>

<p>Return value: TRUE  - the user can perform the audit for the section FALSE
- the user can not perform the audit for the section</p>
          

          
          <div class="method-source-code" id="section_auditor-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 627</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">section_auditor?</span>(<span class="ruby-identifier">section</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-identifier">teammate</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_section_teammate</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_audit?</span>
    ((<span class="ruby-operator">!</span><span class="ruby-identifier">teammate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer_id</span>) <span class="ruby-operator">||</span> ( <span class="ruby-identifier">teammate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">teammate</span>))
  <span class="ruby-keyword">else</span>
    (<span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_complete?</span> <span class="ruby-operator">&amp;&amp;</span>
     ((<span class="ruby-operator">!</span><span class="ruby-identifier">teammate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">peer_id</span>) <span class="ruby-operator">||</span> ( <span class="ruby-identifier">teammate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">teammate</span>)))
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- section_auditor-3F-source -->
          
        </div>

        

        
      </div><!-- section_auditor-3F-method -->

    
      <div id="method-i-self_auditor" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            self_audtor(section) &rarr; user
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve the self <a href="Audit.html#method-i-auditor">#auditor</a> for
the section.</p>

<pre>If a self auditor for the section is assigned then the user record is returned.
Otherwise the user record for the design's lead designer is returned.
A nil is returned if none of the above conditions apply.</pre>
          

          
          <div class="method-source-code" id="self_auditor-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1567</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">self_auditor</span>(<span class="ruby-identifier">section</span>)
  
  <span class="ruby-identifier">auditor</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">audit_teammates</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">tmate</span><span class="ruby-operator">|</span> <span class="ruby-identifier">tmate</span>.<span class="ruby-identifier">section_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">tmate</span>.<span class="ruby-identifier">self?</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">auditor</span>
    <span class="ruby-identifier">auditor</span>.<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> 
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">designer</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- self_auditor-source -->
          
        </div>

        

        
      </div><!-- self_auditor-method -->

    
      <div id="method-i-self_auditor_list" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            self_audtor_list() &rarr; array
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Retrieve a list of designers eligible to perform a self audit.</p>

<pre>The array returned contains a list of active designers.</pre>
          

          
          <div class="method-source-code" id="self_auditor_list-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">self_auditor_list</span>
  <span class="ruby-ivar">@self_auditor_list</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Role</span>.<span class="ruby-identifier">active_designers</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- self_auditor_list-source -->
          
        </div>

        

        
      </div><!-- self_auditor_list-method -->

    
      <div id="method-i-self_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">self_check_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-self_check_count">#self_check_count</a></p>

<p>Description: This method returns the number of checks for the self audit
team based on the design type.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="self_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 433</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">self_check_count</span>

  <span class="ruby-identifier">checklist</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>

  <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">design_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'New'</span>
    <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">new_design_self_check_count</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'Dot Rev'</span>
    <span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">bareboard_design_self_check_count</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- self_check_count-source -->
          
        </div>

        

        
      </div><!-- self_check_count-method -->

    
      <div id="method-i-self_percent_complete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">self_percent_complete</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-self_percent_complete">#self_percent_complete</a></p>

<p>Description: This method returns percent complete statistics for the  self
audit team.</p>

<p>Parameters: None</p>
          

          
          <div class="method-source-code" id="self_percent_complete-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 460</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">self_percent_complete</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_check_count</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> * <span class="ruby-value">100.0</span> <span class="ruby-operator">/</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_check_count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-value">100.0</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- self_percent_complete-source -->
          
        </div>

        

        
      </div><!-- self_percent_complete-method -->

    
      <div id="method-i-self_update-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">self_update?</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-self_update-3F">#self_update?</a></p>

<p>Description: The method determines if the update that is being processed is
a self audit update.</p>

<p>Parameters: user - a user record that identifies the person who is logged
in.</p>

<p>Return value: True if the update is to the self audit.  Otherwise, false</p>
          

          
          <div class="method-source-code" id="self_update-3F-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 726</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">self_update?</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_audit?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_auditor?</span>(<span class="ruby-identifier">user</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- self_update-3F-source -->
          
        </div>

        

        
      </div><!-- self_update-3F-method -->

    
      <div id="method-i-set_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_message</span><span
            class="method-args">(message, append=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-set_message">#set_message</a></p>

<p>Description: Creates or appends the <a
href="Audit.html#method-i-message">#message</a> to the error <a
href="Audit.html#method-i-message">#message</a> depending on the append
flag</p>

<p>Parameters: append - a flag that indicates the <a
href="Audit.html#method-i-message">#message</a> should be appended to any
existing error <a href="Audit.html#method-i-message">#message</a> when True</p>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="set_message-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">append</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">append</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:message</span>, <span class="ruby-identifier">message</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_message-source -->
          
        </div>

        

        
      </div><!-- set_message-method -->

    
      <div id="method-i-trim_checklist_for_design_type" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            trim_checklist_for_design_type() &rarr; audit
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Trim sections, subsections, and checks from the audit that do not apply.</p>

<p>The resulting audit checklist contains only the sections, subsection, and
checks that apply to the audit.</p>
          

          
          <div class="method-source-code" id="trim_checklist_for_design_type-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">trim_checklist_for_design_type</span>
  
  <span class="ruby-identifier">design</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>
  
  <span class="ruby-comment"># Remove the sections that are not used in the audit.</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">design</span>.<span class="ruby-identifier">belongs_to</span>(<span class="ruby-identifier">section</span>) }
  
   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
     
    <span class="ruby-comment"># Remove the subsections that are not used in the audit.</span>
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">design</span>.<span class="ruby-identifier">belongs_to</span>(<span class="ruby-identifier">subsection</span>) }
    
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># Remove the checks that are not used in the audit.</span>
      <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">checks</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">design</span>.<span class="ruby-identifier">belongs_to</span>(<span class="ruby-identifier">check</span>) }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- trim_checklist_for_design_type-source -->
          
        </div>

        

        
      </div><!-- trim_checklist_for_design_type-method -->

    
      <div id="method-i-trim_checklist_for_peer_audit" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            trim_checklist_for_peer_audit() &rarr; audit
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Trim checks that do no apply to a peer audit.</p>

<p>The resulting audit checklist contains only the checks that apply to a 
peer audit.</p>
          

          
          <div class="method-source-code" id="trim_checklist_for_peer_audit-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1504</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">trim_checklist_for_peer_audit</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_checklist_for_design_type</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">checks</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_peer_check?</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
 <span class="ruby-comment"># Lop off any empty sections and subsections</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span> <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- trim_checklist_for_peer_audit-source -->
          
        </div>

        

        
      </div><!-- trim_checklist_for_peer_audit-method -->

    
      <div id="method-i-trim_checklist_for_self_audit" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            trim_checklist_for_self_audit() &rarr; audit
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Trim checks that do no apply to a self audit.</p>

<p>The resulting audit checklist contains only the checks that apply to a 
self audit.</p>
          

          
          <div class="method-source-code" id="trim_checklist_for_self_audit-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1479</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">trim_checklist_for_self_audit</span>
   
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_checklist_for_design_type</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">checks</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_self_check?</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
   
  <span class="ruby-comment"># Lop off any empty sections and subsections</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">section</span>.<span class="ruby-identifier">subsections</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subsection</span><span class="ruby-operator">|</span> <span class="ruby-identifier">subsection</span>.<span class="ruby-identifier">check_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
  <span class="ruby-keyword">end</span>
   
<span class="ruby-keyword">end</span></pre>
          </div><!-- trim_checklist_for_self_audit-source -->
          
        </div>

        

        
      </div><!-- trim_checklist_for_self_audit-method -->

    
      <div id="method-i-update_checklist_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_checklist_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-update_checklist_type">#update_checklist_type</a></p>

<p>Description: This method creates or destroys design checks based on the
type of design the audit is tied to.  This is used when the type of design
is changed.</p>

<p>Parameters: None</p>

<p>Returns: The number of design checks added or deleted.</p>
          

          
          <div class="method-source-code" id="update_checklist_type-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_checklist_type</span>

  <span class="ruby-identifier">design_checks</span> = <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;audit_id=#{self.id}&quot;</span>)
  <span class="ruby-identifier">delta</span> = <span class="ruby-value">0</span>
  
  <span class="ruby-comment"># Keep track of the completed checks that are deleted to update the</span>
  <span class="ruby-comment"># audit counts of the completed checks.</span>
  <span class="ruby-identifier">completed_self_check_delta</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">completed_peer_audit_delta</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">design_check</span> = <span class="ruby-identifier">design_checks</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dc</span>.<span class="ruby-identifier">check_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">id</span> }
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">belongs_to?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">design</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">design_check</span>
        <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">add</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">check</span>)
        <span class="ruby-identifier">delta</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># Keep track of the adjustments that need to be made for the totals</span>
      <span class="ruby-identifier">completed_self_check_delta</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">self_auditor_checked?</span>
      <span class="ruby-identifier">completed_peer_audit_delta</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">peer_auditor_checked?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_check</span>
        <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-identifier">delta</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># If any of the deleted design checks were complete then the audit record needs to</span>
  <span class="ruby-comment"># be updated.</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_self_check_count</span>(<span class="ruby-identifier">completed_self_check_delta</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">completed_self_check_delta</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_peer_check_count</span>(<span class="ruby-identifier">completed_peer_audit_delta</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">completed_peer_audit_delta</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  
  <span class="ruby-identifier">delta</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_checklist_type-source -->
          
        </div>

        

        
      </div><!-- update_checklist_type-method -->

    
      <div id="method-i-update_design_check" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            update_design_check(design_check_update, user) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Update the audit’s design check.</p>

<pre>Determine the type of update that was passed in, self or peer, and 
use the information to make the update to the stored design check.  Also
make sure that any update that requires a comment includes the comment.
If a required comment is not provided, the objects errors structure is
updated.  The caller is responsible for checking for errors.

If a comment is included in the update then an Audit Comment record is 
created and stored.</pre>
          

          
          <div class="method-source-code" id="update_design_check-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1670</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_design_check</span>(<span class="ruby-identifier">design_check_update</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  
  <span class="ruby-identifier">self_audit_result</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:designer_result</span>]
  <span class="ruby-identifier">peer_audit_result</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:auditor_result</span>]

  <span class="ruby-identifier">updated</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">design_check</span> = <span class="ruby-constant">DesignCheck</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:design_check_id</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">self_audit_result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_update?</span>(<span class="ruby-identifier">user</span>)
    <span class="ruby-identifier">result</span>  = <span class="ruby-identifier">self_audit_result</span>
    <span class="ruby-identifier">updated</span> = <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">peer_audit_result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_update?</span>(<span class="ruby-identifier">user</span>)
    <span class="ruby-identifier">result</span>  = <span class="ruby-identifier">peer_audit_result</span>
    <span class="ruby-identifier">updated</span> = <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">design_check_update</span>[<span class="ruby-value">:comment</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">updated</span>
    
    <span class="ruby-comment"># Make sure that the required comment has been included.</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">comment</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> 
        <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">comment_required?</span>(<span class="ruby-identifier">self_audit_result</span>, <span class="ruby-identifier">peer_audit_result</span>))
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:comment_required</span>, <span class="ruby-node">&quot;A comment is required for a #{result} response.&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_update?</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_self_audit_update</span>(<span class="ruby-identifier">self_audit_result</span>, <span class="ruby-identifier">design_check</span>, <span class="ruby-identifier">user</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_update?</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_peer_audit_update</span>(<span class="ruby-identifier">peer_audit_result</span>, <span class="ruby-identifier">comment</span>, <span class="ruby-identifier">design_check</span>, <span class="ruby-identifier">user</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># If the user entered a comment, add the record to the database.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">comment</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-constant">AuditComment</span>.<span class="ruby-identifier">new</span>( <span class="ruby-value">:comment</span>         =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>,
                      <span class="ruby-value">:user_id</span>         =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>,
                      <span class="ruby-value">:design_check_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">id</span> ).<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
    
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_design_check-source -->
          
        </div>

        

        
      </div><!-- update_design_check-method -->

    
      <div id="method-i-update_peer_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_peer_check_count</span><span
            class="method-args">(count = 1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-update_peer_check_count">#update_peer_check_count</a></p>

<p>Description: Increments the <a
href="Audit.html#method-i-auditor">#auditor</a> (peer) completed check
count by count.  If the caller does not specify the count then the
increment is by 1. If another user has updated the record,  the exception
handler code is executed.  The audit record is reloaded and the work is
redone.</p>

<p>Parameters:</p>

<p>count - provides the increment value</p>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="update_peer_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_peer_check_count</span>(<span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">completed_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span> = <span class="ruby-identifier">completed_checks</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete</span>         = (<span class="ruby-identifier">completed_checks</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">peer_check_count</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StaleObjectError</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reload</span>
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_peer_check_count-source -->
          
        </div>

        

        
      </div><!-- update_peer_check_count-method -->

    
      <div id="method-i-update_self_check_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_self_check_count</span><span
            class="method-args">(count = 1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="Audit.html#method-i-update_self_check_count">#update_self_check_count</a></p>

<p>Description: Increments the designer (self) completed check count by count.
If the caller does not specify the count then the increment is by 1. If
another user has updated the record,  the exception handler code is
executed.  The audit record is reloaded and the work is redone.</p>

<p>Parameters: count - provides the increment value</p>

<p>Return value: None</p>
          

          
          <div class="method-source-code" id="update_self_check_count-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 1155</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_self_check_count</span>(<span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">completed_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">count</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> = <span class="ruby-identifier">completed_checks</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete</span>         = (<span class="ruby-identifier">completed_checks</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">self_check_count</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StaleObjectError</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reload</span>
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_self_check_count-source -->
          
        </div>

        

        
      </div><!-- update_self_check_count-method -->

    
      <div id="method-i-update_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_type</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="Audit.html#method-i-update_type">#update_type</a></p>

<p>Description: The method returns the update type based on the user and the
state of the audit (self audit vs. peer audit).</p>

<p>Parameters: user - a user record that identifies the person who is logged
in.</p>

<p>Return value: A string that indicates the state of audit - self, peer, or
none</p>
          

          
          <div class="method-source-code" id="update_type-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 699</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_type</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">if</span>    (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_auditor?</span>(<span class="ruby-identifier">user</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_self_audit?</span>)
    <span class="ruby-value">:self</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_auditor?</span>(<span class="ruby-identifier">user</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_peer_audit?</span>)
    <span class="ruby-value">:peer</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-value">:none</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_type-source -->
          
        </div>

        

        
      </div><!-- update_type-method -->

    
      <div id="method-i-verify_all_checks" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            verify_all_checks() &rarr; boolean
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Verify all of the audit’s design checks.</p>

<p>Set all design check results, both self and peer, to ‘Verified’ and set the
audit’s state variables to indicate that the audit is complete.</p>
          

          
          <div class="method-source-code" id="verify_all_checks-source">
            <pre><span class="ruby-comment"># File app/models/audit.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verify_all_checks</span>
  
  <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_checklist_for_design_type</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_design_checks</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checklist</span>.<span class="ruby-identifier">each_check</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">check</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_peer_check?</span>
      <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_result</span>     = <span class="ruby-string">'Verified'</span>
      <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">auditor_checked_on</span> = <span class="ruby-identifier">now</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>.<span class="ruby-identifier">is_self_check?</span>
      <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_result</span>     = <span class="ruby-string">'Verified'</span>
      <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">designer_checked_on</span> = <span class="ruby-identifier">now</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">check</span>.<span class="ruby-identifier">design_check</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">completed_checks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">completed_check_count</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_completed_checks</span>  = <span class="ruby-identifier">completed_checks</span>[<span class="ruby-value">:peer</span>]
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">auditor_complete</span>          = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_completed_checks</span> = <span class="ruby-identifier">completed_checks</span>[<span class="ruby-value">:self</span>]
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">designer_complete</span>         = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- verify_all_checks-source -->
          
        </div>

        

        
      </div><!-- verify_all_checks-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

