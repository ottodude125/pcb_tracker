<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Class: Document</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/document.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-attach">#attach</a>
    
    <li><a href="#method-i-base_part_of">#base_part_of</a>
    
    <li><a href="#method-i-document-3D">#document=</a>
    
    <li><a href="#method-i-user">#user</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Audit.html">Audit</a>
  
    <li><a href="./AuditComment.html">AuditComment</a>
  
    <li><a href="./AuditController.html">AuditController</a>
  
    <li><a href="./AuditMailer.html">AuditMailer</a>
  
    <li><a href="./AuditTeammate.html">AuditTeammate</a>
  
    <li><a href="./Board.html">Board</a>
  
    <li><a href="./BoardController.html">BoardController</a>
  
    <li><a href="./BoardDesignEntry.html">BoardDesignEntry</a>
  
    <li><a href="./BoardDesignEntryController.html">BoardDesignEntryController</a>
  
    <li><a href="./BoardDesignEntryMailer.html">BoardDesignEntryMailer</a>
  
    <li><a href="./BoardDesignEntryUser.html">BoardDesignEntryUser</a>
  
    <li><a href="./BoardHelper.html">BoardHelper</a>
  
    <li><a href="./BoardReviewer.html">BoardReviewer</a>
  
    <li><a href="./CcListHistory.html">CcListHistory</a>
  
    <li><a href="./ChangeClass.html">ChangeClass</a>
  
    <li><a href="./ChangeClassesController.html">ChangeClassesController</a>
  
    <li><a href="./ChangeDetail.html">ChangeDetail</a>
  
    <li><a href="./ChangeDetailsController.html">ChangeDetailsController</a>
  
    <li><a href="./ChangeItem.html">ChangeItem</a>
  
    <li><a href="./ChangeItemsController.html">ChangeItemsController</a>
  
    <li><a href="./ChangeType.html">ChangeType</a>
  
    <li><a href="./ChangeTypesController.html">ChangeTypesController</a>
  
    <li><a href="./Check.html">Check</a>
  
    <li><a href="./CheckController.html">CheckController</a>
  
    <li><a href="./Checklist.html">Checklist</a>
  
    <li><a href="./ChecklistController.html">ChecklistController</a>
  
    <li><a href="./ChecklistHelper.html">ChecklistHelper</a>
  
    <li><a href="./CoreExtensions.html">CoreExtensions</a>
  
    <li><a href="./DbCheck.html">DbCheck</a>
  
    <li><a href="./DebugController.html">DebugController</a>
  
    <li><a href="./DebugHelper.html">DebugHelper</a>
  
    <li><a href="./Design.html">Design</a>
  
    <li><a href="./DesignCenter.html">DesignCenter</a>
  
    <li><a href="./DesignCenterController.html">DesignCenterController</a>
  
    <li><a href="./DesignCenterManagerController.html">DesignCenterManagerController</a>
  
    <li><a href="./DesignChange.html">DesignChange</a>
  
    <li><a href="./DesignChangesController.html">DesignChangesController</a>
  
    <li><a href="./DesignChangesHelper.html">DesignChangesHelper</a>
  
    <li><a href="./DesignCheck.html">DesignCheck</a>
  
    <li><a href="./DesignController.html">DesignController</a>
  
    <li><a href="./DesignDirectory.html">DesignDirectory</a>
  
    <li><a href="./DesignDirectoryController.html">DesignDirectoryController</a>
  
    <li><a href="./DesignPcbasHelper.html">DesignPcbasHelper</a>
  
    <li><a href="./DesignReview.html">DesignReview</a>
  
    <li><a href="./DesignReviewComment.html">DesignReviewComment</a>
  
    <li><a href="./DesignReviewController.html">DesignReviewController</a>
  
    <li><a href="./DesignReviewDocument.html">DesignReviewDocument</a>
  
    <li><a href="./DesignReviewHelper.html">DesignReviewHelper</a>
  
    <li><a href="./DesignReviewMailer.html">DesignReviewMailer</a>
  
    <li><a href="./DesignReviewResult.html">DesignReviewResult</a>
  
    <li><a href="./DesignReviewResultController.html">DesignReviewResultController</a>
  
    <li><a href="./DesignUpdate.html">DesignUpdate</a>
  
    <li><a href="./DesignUpdateController.html">DesignUpdateController</a>
  
    <li><a href="./Division.html">Division</a>
  
    <li><a href="./DivisionController.html">DivisionController</a>
  
    <li><a href="./Document.html">Document</a>
  
    <li><a href="./DocumentController.html">DocumentController</a>
  
    <li><a href="./DocumentMailer.html">DocumentMailer</a>
  
    <li><a href="./DocumentType.html">DocumentType</a>
  
    <li><a href="./DocumentTypeController.html">DocumentTypeController</a>
  
    <li><a href="./EcoComment.html">EcoComment</a>
  
    <li><a href="./EcoDocument.html">EcoDocument</a>
  
    <li><a href="./EcoDocumentsController.html">EcoDocumentsController</a>
  
    <li><a href="./EcoTask.html">EcoTask</a>
  
    <li><a href="./EcoTaskMailer.html">EcoTaskMailer</a>
  
    <li><a href="./EcoTaskReportsController.html">EcoTaskReportsController</a>
  
    <li><a href="./EcoTasksController.html">EcoTasksController</a>
  
    <li><a href="./EcoType.html">EcoType</a>
  
    <li><a href="./FabHouse.html">FabHouse</a>
  
    <li><a href="./FabHouseController.html">FabHouseController</a>
  
    <li><a href="./FtpNotification.html">FtpNotification</a>
  
    <li><a href="./IncomingDirectory.html">IncomingDirectory</a>
  
    <li><a href="./IncomingDirectoryController.html">IncomingDirectoryController</a>
  
    <li><a href="./IpdPost.html">IpdPost</a>
  
    <li><a href="./IpdPostHelper.html">IpdPostHelper</a>
  
    <li><a href="./Location.html">Location</a>
  
    <li><a href="./LocationController.html">LocationController</a>
  
    <li><a href="./LoginSystem.html">LoginSystem</a>
  
    <li><a href="./MailerMethods.html">MailerMethods</a>
  
    <li><a href="./OiAssignment.html">OiAssignment</a>
  
    <li><a href="./OiAssignmentComment.html">OiAssignmentComment</a>
  
    <li><a href="./OiAssignmentReport.html">OiAssignmentReport</a>
  
    <li><a href="./OiCategory.html">OiCategory</a>
  
    <li><a href="./OiCategorySection.html">OiCategorySection</a>
  
    <li><a href="./OiInstruction.html">OiInstruction</a>
  
    <li><a href="./OiInstructionController.html">OiInstructionController</a>
  
    <li><a href="./OiInstructionHelper.html">OiInstructionHelper</a>
  
    <li><a href="./OiInstructionMailer.html">OiInstructionMailer</a>
  
    <li><a href="./PartNum.html">PartNum</a>
  
    <li><a href="./PartNumber.html">PartNumber</a>
  
    <li><a href="./PartNumsController.html">PartNumsController</a>
  
    <li><a href="./PartNumsHelper.html">PartNumsHelper</a>
  
    <li><a href="./Pcbtr.html">Pcbtr</a>
  
    <li><a href="./Ping.html">Ping</a>
  
    <li><a href="./PingMailer.html">PingMailer</a>
  
    <li><a href="./Platform.html">Platform</a>
  
    <li><a href="./PlatformController.html">PlatformController</a>
  
    <li><a href="./PostingTimestamp.html">PostingTimestamp</a>
  
    <li><a href="./Prefix.html">Prefix</a>
  
    <li><a href="./PrefixController.html">PrefixController</a>
  
    <li><a href="./Priority.html">Priority</a>
  
    <li><a href="./PriorityController.html">PriorityController</a>
  
    <li><a href="./ProductType.html">ProductType</a>
  
    <li><a href="./ProductTypeController.html">ProductTypeController</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectController.html">ProjectController</a>
  
    <li><a href="./ReportController.html">ReportController</a>
  
    <li><a href="./ReportHelper.html">ReportHelper</a>
  
    <li><a href="./ReviewGroup.html">ReviewGroup</a>
  
    <li><a href="./ReviewGroupController.html">ReviewGroupController</a>
  
    <li><a href="./ReviewManagerController.html">ReviewManagerController</a>
  
    <li><a href="./ReviewStatus.html">ReviewStatus</a>
  
    <li><a href="./ReviewStatusController.html">ReviewStatusController</a>
  
    <li><a href="./ReviewType.html">ReviewType</a>
  
    <li><a href="./ReviewTypeController.html">ReviewTypeController</a>
  
    <li><a href="./Revision.html">Revision</a>
  
    <li><a href="./Role.html">Role</a>
  
    <li><a href="./RoleController.html">RoleController</a>
  
    <li><a href="./Section.html">Section</a>
  
    <li><a href="./SectionController.html">SectionController</a>
  
    <li><a href="./SessionCleaner.html">SessionCleaner</a>
  
    <li><a href="./Subsection.html">Subsection</a>
  
    <li><a href="./SubsectionController.html">SubsectionController</a>
  
    <li><a href="./TimeHelper.html">TimeHelper</a>
  
    <li><a href="./TrackerController.html">TrackerController</a>
  
    <li><a href="./TrackerFix.html">TrackerFix</a>
  
    <li><a href="./TrackerHelper.html">TrackerHelper</a>
  
    <li><a href="./TrackerMailer.html">TrackerMailer</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserController.html">UserController</a>
  
    <li><a href="./UserLogin.html">UserLogin</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Document</h1>

  <div id="description" class="description">
    
<p>Copyright 2005, by Teradyne, Inc., Boston MA</p>

<p>File: document.rb</p>

<p>This file maintains the state for documents.</p>

<p>$Id$</p>

<p>TODO:  <a href="Document.html#MAX_FILE_SIZE">MAX_FILE_SIZE</a> SB 16M</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="MAX_FILE_SIZE">MAX_FILE_SIZE
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-attach" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            attach(design_review, document_type, user) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Store this instance of the document in the database and create a new design
review document record.</p>

<p>The document is stored in the database, a design review document is
created, and mail is sent to indicate that the document has been attached.
If the data is too large to store, then none of that happens.  An error is
returned to indicate the problem.</p>
          

          
          <div class="method-source-code" id="attach-source">
            <pre><span class="ruby-comment"># File app/models/document.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attach</span>(<span class="ruby-identifier">design_review</span>, <span class="ruby-identifier">document_type</span>, <span class="ruby-identifier">user</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Document</span><span class="ruby-operator">::</span><span class="ruby-constant">MAX_FILE_SIZE</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">created_by</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">unpacked</span>   = <span class="ruby-value">0</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">drd_doc</span> = <span class="ruby-constant">DesignReviewDocument</span>.<span class="ruby-identifier">new</span>( <span class="ruby-value">:document_type_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">document_type</span>.<span class="ruby-identifier">id</span>,
                                          <span class="ruby-value">:board_id</span>         =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">design_review</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">board_id</span>,
                                          <span class="ruby-value">:design_id</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">design_review</span>.<span class="ruby-identifier">design_id</span>,
                                          <span class="ruby-value">:document_id</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>)
                                        
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">drd_doc</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-identifier">design_review</span>.<span class="ruby-identifier">reload</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">design_review</span>.<span class="ruby-identifier">design</span>.<span class="ruby-identifier">board</span>.<span class="ruby-identifier">multiple_documents?</span>(<span class="ruby-identifier">document_type</span>)
          <span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;Updated #{document_type.name} document - #{self.name}&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;Created #{document_type.name} document - #{self.name}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-constant">DocumentMailer</span><span class="ruby-operator">::</span><span class="ruby-identifier">attachment_update</span>(<span class="ruby-identifier">drd_doc</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">subject</span>).<span class="ruby-identifier">deliver</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:design_review_document</span>, <span class="ruby-string">&quot;Failed to create the design review document&quot;</span>)
        <span class="ruby-comment"># TODO: THIS CALLS FOR LOGGING</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:file_size</span>, <span class="ruby-node">&quot;Files must be smaller than #{Document::MAX_FILE_SIZE} characters&quot;</span>)
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- attach-source -->
          
        </div>

        

        
      </div><!-- attach-method -->

    
      <div id="method-i-document-3D" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            document=(document_field) &rarr; document
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Set the document fields using the document_field record</p>

<p>The document fields are loaded with the new data</p>
          

          
          <div class="method-source-code" id="document-3D-source">
            <pre><span class="ruby-comment"># File app/models/document.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">document=</span>(<span class="ruby-identifier">document_field</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>         = <span class="ruby-identifier">base_part_of</span>(<span class="ruby-identifier">document_field</span>.<span class="ruby-identifier">original_filename</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">document_field</span>.<span class="ruby-identifier">content_type</span>.<span class="ruby-identifier">chomp</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">data</span>         = <span class="ruby-identifier">document_field</span>.<span class="ruby-identifier">read</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- document-3D-source -->
          
        </div>

        

        
      </div><!-- document-3D-method -->

    
      <div id="method-i-user" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            user() &rarr; user
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Return the record of the <a href="Document.html#method-i-user">#user</a>
who created the document</p>

<p>Looks up the <a href="Document.html#method-i-user">#user</a> and returns
the record</p>
          

          
          <div class="method-source-code" id="user-source">
            <pre><span class="ruby-comment"># File app/models/document.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user</span>
  <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">created_by</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">created_by</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user-source -->
          
        </div>

        

        
      </div><!-- user-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-base_part_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">base_part_of</span><span
            class="method-args">(file_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="base_part_of-source">
            <pre><span class="ruby-comment"># File app/models/document.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">base_part_of</span>(<span class="ruby-identifier">file_name</span>)
  <span class="ruby-identifier">name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file_name</span>)
  <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[^\w._-]/</span>, <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- base_part_of-source -->
          
        </div>

        

        
      </div><!-- base_part_of-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

