<!-- View:    board_design_entry                                -->
<!-- Purpose: Displays a form to add a new PCB Engineering      -->
<!--          Entry.                                            -->
<!-- ********************************************************** -->
<!-- $Id$ -->
<!-- ********************************************************** -->

<%  content_for :header do %>

jQuery(function($) {
  $(":checkbox").change( function () {
    field = this.name;
    value = $(this).attr("checked")?1:0;  /* user id */
    url   = $(this).parents("table").attr('url');

    //alert("entered value = " + value + " field = " + field + " url=" + url) ;
    $.post(url, { field: field, value: value} ); //no return data
  });
});

<% end %>

<% if @user_action == 'updating' %>

  <% @heading = "PCB Engineering - Design Details " + 
   @board_design_entry.pcb_number + " - Updating"

     action   = { :action      => 'update_entry',
                  :id          => @board_design_entry.id,
                  :user_action => 'updating',
                  :viewer      => @viewer }
     user     = @board_design_entry.user %>



<% elsif @user_action == 'adding' %>
  <% @bde_type = (@planning == "planning") ? "Planning" : "Board" %>
  <% @heading = "PCB Engineering - Design Details "  +
  @board_design_entry.pcb_number + ' - New ' + @bde_type + " Entry "
  
     action   = { :action      => 'update_entry',
                  :id          => @board_design_entry.id,
                  :user_action => 'adding' }
     user     = @logged_in_user %>
                      
<% end %>

<%= form_tag(action) do %>


<hr class="div" />

<table width="90%" align="center" border="2" cellspacing="0">

<!-- ********************************************************** -->
  <tr>
  
    <td class="label">Originator: </td>
    <td class="data"  width="150px"><%= user.name %></td>
    
    <td class="label">Division: </td>
    <td class="data"  style="color:red; font-weight:bold;">
      <select id="board_design_entry_division_id"
              name="board_design_entry[division_id]">
      <option value="0"></option>
      <%= options_from_collection_for_select(@division_list,
                                             "id",
                                             "name",
                                             user.division_id) %>
      </select> &nbsp; &nbsp; required
    </td>

    <td class="label">Location: </td>
    <td class="data"  style="color:red; font-weight:bold;">
      <select id="board_design_entry_location_id"
              name="board_design_entry[location_id]">
      <option value="0"></option>
      <%= options_from_collection_for_select(@location_list,
                                             "id",
                                             "name",
                                             user.location_id) %> 
      </select> &nbsp; &nbsp; required
    </td>
  </tr>

<!-- ********************************************************** -->
  <%- @part_nums.each do |pn| %>
    <%- if pn.use == "pcb" %>
      <tr>
        <td class="label">PCB Part Number: </td>
        <td class="data" width="150px" >
          <%= pn.name_string + " " + pn.revision %>
        </td>
        <td class="data" colspan="6"  style="border-left:transparent;" >
          <%= text_field("part_num[#{pn.id}]", "description", :value => pn.description, "size" => 60, "maxlength" => 80, :placeholder => "Teamcenter Description Not Found") %> 
          <span style="font-weight:normal; font-size: 10px; ">(auto updated from teamcenter)</span>
        </td>
      </tr>
    <% end %>
  <% end %>    
    
  <%- @part_nums.each do |pn| %>
    <%- if pn.use == "pcba" %>
      <tr>
        <td class="label" >PCBA: </td>
        <td class="data" width="150px">
            <%= pn.name_string %>
        </td>
        <td class="data" colspan="6" style="border-left:transparent;" >
          <%= text_field("part_num[#{pn.id}]", "description", :value => pn.description, "size" => 60, "maxlength" => 80, :placeholder => "Teamcenter Description Not Found") %> 
          <span style="font-weight:normal; font-size: 10px; ">(auto updated from teamcenter)</span>
        </td>
      </tr>
    <% end %>
  <% end %>    
  
<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">Platform: </td>
    <td class="data" colspan="6" style="color:red; font-weight:bold;">
      <%= select("board_design_entry", 
                 "platform_id", 
                 @platform_list.collect { |p| [ p.name, p.id ] }, 
                 { :include_blank => true },
                 "class" => 'wide_select' ) %> &nbsp; &nbsp; required
           
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">Project: </td>
    <td class="data" colspan="6" style="color:red; font-weight:bold;">
      <%= select("board_design_entry", 
                 "project_id", 
                 @project_list.collect { |p| [ p.name, p.id ] }, 
                 { :include_blank => true },
                 "class" => 'wide_select' ) %> &nbsp; &nbsp; required
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">Product Type: </td>
    <td class="data" colspan="6" style="color:red; font-weight:bold;">
      <%= select("board_design_entry", 
                 "product_type_id", 
                 @product_type_list.collect { |p| [ p.name, p.id ] }, 
                 { :include_blank => true },
                 "class" => 'wide_select' ) %> &nbsp; &nbsp; required

    </td>
  </tr>
  
<!-- ********************************************************** -->
  <tr valign="top">
    <td class="label" valign="top">Location of Review Documents: <br />(\\server_name\...)</td>
    <td class="data" colspan="6">
      <%= text_field("board_design_entry", "review_doc_location", "size" => 127, "maxlength" => 127) %>
      <%# text_area("board_design_entry",
                    "review_doc_location",
                    { :rows => '2', :cols => '60' }) %>
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">Design Directory Location: </td>
    <td class="data" colspan="6" valign="top">
      <%= select("board_design_entry", 
                 "design_directory_id", 
                 @design_dir_list.collect { |dd| [ dd.name, dd.id ] }, 
                 { :include_blank => true },
                 "class" => 'wide_select' ) %>
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">Incoming Directory Location: </td>
    <td class="data" colspan="6" valign="top">
      <%= select("board_design_entry", 
                 "incoming_directory_id", 
                 @incoming_dir_list.collect { |id| [ id.name, id.id ] }, 
                 { :include_blank => true },
                 "class" => 'wide_select' ) %>
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <%  mkfrm = @board_design_entry.make_from? %>
    <td class="label" valign="top">Make From: </td>
    <td class="data" colspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="label" width="140">Yes: </td>
            <td class="data" align="left">
             <%= radio_button_tag('board_design_entry[make_from]', 1,
               mkfrm == true ? true:false,
               :onclick => "$(\'make_from\').style.display = \'block';" ) %>
            </td>                
          </tr>
          <tr>
            <td class="label">No: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[make_from]', 0, mkfrm == true ? false:true,
                :onclick => "$(\'make_from\').style.display = \'none';" ) %>
            </td>
          </tr>
        </table>
    </td>
    <td class="data" colspan="4">
   <div id="make_from" <%=  mkfrm == true ? "style=display:'block'" :
  "style=\"display: none;\""%> >
      <table><tr>
      <td class="label" width="200"
        title="Identify the original PCB">
      Original PCB Number:
      </td>
      <td class="data">
      <%= text_field("board_design_entry",
        "original_pcb_number",
        "size" => 16) %>
      </td>
      </tr></table>
   </div>
    </td>
  </tr>


<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">ASIC/FPGA on Board:</td>
    <td class="data" colspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="label" width="140">Yes: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[asic_fpga]', '1' ,
              !!@board_design_entry.asic_fpga) %>
            </td>
          </tr>
          <tr>
            <td class="label">No: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[asic_fpga]', '0',
              !@board_design_entry.asic_fpga ) %>
            </td>
          </tr>
        </table>
    </td>
    <td class="data" colspan="4" valign="top">&nbsp;</td>
  </tr>

<!-- ********************************************************** -->
  <tr>
    <td class="label" valign="top">HiPot Testing Required: </td>
    <td class="data" colspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="label" width="140">Yes: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[hipot_testing_required]', '1',
              @board_design_entry.hipot_testing_required == 1 ) %>
            </td>
          </tr>
          <tr>
            <td class="label">No: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[hipot_testing_required]', '0',
              @board_design_entry.hipot_testing_required == 0 ) %>
            </td>
          </tr>
        </table>
    </td>
    <td class="data" colspan="4" valign="top">&nbsp;</td>
  </tr>

<!-- ********************************************************** -->
<tr>
  <td class="label" valign="top">RoHS design:</td>
  <td class="data" colspan="2" valign="top">
    <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="label" width="140">Yes: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[rohs]', '1',
              !!@board_design_entry.rohs ) %>
          </td>
        </tr>
        <tr>
          <td class="label">No: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[rohs]', '0',
              !@board_design_entry.rohs ) %>
          </td>
        </tr>
      </table>
    </td>
   <td class="data" colspan="4" valign="top">&nbsp;</td>
  </tr>
  <!-- ********************************************************** -->
  <tr>
      <td class="label" valign="top">Manual Thieving:</td>
      <td class="data" colspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0">
          <tr>
            <td class="label" width="140">Yes: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[thieving]', '1',
                !!@board_design_entry.thieving ) %>
            </td>
          </tr>
          <tr>
            <td class="label">No: </td>
            <td class="data" align="left">
              <%= radio_button_tag('board_design_entry[thieving]', '0',
                !@board_design_entry.thieving ) %>
            </td>
          </tr>
        </table>
      </td>
      <td class="data" colspan="4" valign="top">
        THIEVING is non-functional copper patterns that are added to a
        design to balance the layers and improve manufacturability(fabrication
        drawing: note 9)<br/>
        This is very important on designs that use thin core material where the
        copper on either side of the thin core is not a full plane.
      </td>
    </tr>
<!-- ********************************************************** -->
<tr>
    <td class="label" valign="top">Copper Free Areas:</td>
    <td class="data" colspan="2" valign="top">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="label" width="140">Yes: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[no_copper]', '1',
              !!@board_design_entry.no_copper) %>
          </td>
        </tr>
        <tr>
          <td class="label">No: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[no_copper]', '0',
              !@board_design_entry.no_copper) %>
          </td>
        </tr>
      </table>
    </td>
      <td class="data" colspan="4" valign="top">
        Will this design have areas that must be free of copper and/or thieving?<br>
        Mechanical route keepout areas are defined on the mechanical outline
        drawing and will be transferred to the fabrication drawing as a
        "COPPER KEEPOUT AREA" label. Copper keepout areas required for signal
        integrity must be communicated to PCB Design by the Hardware Engineer.
      </td>
   </tr>
<!-- ********************************************************** -->
<tr>
    <td class="label" valign="top">Mech. Enclosures:<br />(Typically RF)</td>
    <td class="data" colspan="2" valign="top">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="label" width="140">Yes: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[enclosure]', '1',
              !!@board_design_entry.enclosure) %>
          </td>
        </tr>
        <tr>
          <td class="label">No: </td>
          <td class="data" align="left">
            <%= radio_button_tag('board_design_entry[enclosure]', '0',
              !@board_design_entry.enclosure) %>
          </td>
        </tr>
      </table>
    </td>
      <td class="data" colspan="4" valign="top">
        If a mechanical enclosure is used around a specific circuit, 
        please add a comment in this form that defines the circuit requiring 
        an enclosure. It would be helpful to add a notation in the schematic 
        also. Once the circuit has been placed the copper area/mounting for 
        the enclosure on the PCB can be fed back to the outline drawing. 
      </td>
   </tr>

<!-- ********************************************************** -->
  <tr valign="top">
    <td class="label" valign="top">Outline Drawing Number: </td>
    <td class="data" colspan="6">
      <%= text_field("board_design_entry", "outline_drawing_number", "size" => 40, "maxlength" => 40) %>
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr valign="top">
    <td class="label" valign="top">Requested Start Date: </td>
    <td class="data" colspan="6">
      <%= date_select(:board_design_entry, 
                      'requested_start_date',
                      :start_year => Time.now.strftime("%Y").to_i,
                      :order      => [:month, :day, :year]) %>
    </td>
  </tr>

<!-- ********************************************************** -->
  <tr valign="top">
    <td class="label" valign="top">Requested Completion (FTP) Date: </td>
    <td class="data" colspan="6">
      <%= date_select(:board_design_entry, 
                      'requested_completion_date',
                      :start_year => Time.now.strftime("%Y").to_i,
                      :order      => [:month, :day, :year]) %>
    </td>
  </tr>
  
  <tr>
    <th class="label">Differential Pairs:</th>
    <td class="data" colspan="6">
      <table class="design_constraints" align="center" cellspacing="0" url="<%= url_for(:action =>"update_yes_no")%>">
        <tr>
          <td >
            <%= check_box_tag("differential_pairs",  #name, id
                              1,                     #value
                              @board_design_entry.differential_pairs? #checked
                              ) %>
          </td>
        </tr>
      </table>
  </tr>
  <tr>
    <th class="label">Controlled Impedance:</th>
    <td class="data" colspan="6">
      <table class="design_constraints" align="center" cellspacing="0" url="<%= url_for(:action =>"update_yes_no")%>">
          <tr>
            <td >
              <%= check_box_tag("controlled_impedance", 1, @board_design_entry.controlled_impedance? ) %>
            </td>
          </tr>
      </table>
    </td>
  </tr>
  <tr>
    <th class="label">Scheduled Nets:</th>
    <td class="data" colspan="6">
      <table class="design_constraints" align="center" cellspacing="0" url="<%= url_for(:action =>"update_yes_no")%>">
          <tr>      
            <td>
              <%= check_box_tag("scheduled_nets", 1, @board_design_entry.scheduled_nets? ) %>
            </td>
          </tr>      
      </table>
    </td>
  </tr>
  <tr>
    <th class="label">Propagation Delay:</th>
    <td class="data" colspan="6">
      <table class="design_constraints" align="center" cellspacing="0" url="<%= url_for(:action =>"update_yes_no")%>">
          <tr>
            <td>
              <%= check_box_tag("propagation_delay",1,@board_design_entry.propagation_delay? ) %>
            </td>
          </tr>      
      </table>
    </td>
 </tr>
  <tr>
    <th class="label">Matched Propagation Delay:</th>
    <td class="data" colspan="6">
      <table class="design_constraints" align="center" cellspacing="0" url="<%= url_for(:action =>"update_yes_no")%>">
          <tr>            
            <td>
              <%= check_box_tag("matched_propagation_delay",1,@board_design_entry.matched_propagation_delay? ) %>
            </td>
          </tr>      
      </table>
    </td>
  </tr>

</table>

<hr class="div" />


<table width="80%" align="center">
  <tr>
    <td align="left">
      <% if @user_action == 'updating' %>
	      <% if @design_review_id %>
	        <input type="button" value="Return"
	               onClick="parent.location='<%= url_for( :controller => 'design_review', 
	                                                      :action => 'review_attachments',
	                                                      :id => @design_review_id ) %>'" />
	      <% else %>        
	      	<input type="button" class="form_return" value="Return"
	               onClick="parent.location='<%= url_for( :action => 'view_entry', 
	                                                      :id     => @board_design_entry.id,
	                                                      :viewer => @viewer) %>'" />
	      <% end %>
     <% end %>
    </td>
    
    <% if @planning == "planning" %>
      <td align="center">
        <input type="submit" class="form_submit" name="<%=@planning%>" value="Create Planning (R&D) Board Entry" /> 
      </td>
    <% else %>
    <td align="right">     
      <% if @user_action == 'updating'%>
        <input type="submit" class="form_submit" name="<%=@planning%>" value="Update Entry" />
      <% elsif @user_action == 'adding' %>      
        <input type="submit" class="form_submit" name="<%=@planning%>" value="Continue to Next Step ==>" />
      <% end %>
    </td>
    <% end %>
  </tr>
</table>

<% end %>

<%# debug @board_design_entry.new? %>
<%# debug @user_action %>
<%# debug @viewer %>
<%# debug @division_list %>

